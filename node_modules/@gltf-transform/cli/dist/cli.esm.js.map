{"version":3,"file":"cli.esm.js","sources":["../src/util.ts","../src/inspect.ts","../src/transforms/ktxfix.ts","../src/transforms/merge.ts","../src/transforms/toktx.ts","../src/transforms/xmp.ts","../src/session.ts","../src/validate.ts","../src/config.ts","../src/program.ts","../src/cli.ts"],"sourcesContent":["import { spawn as _spawn } from 'child_process';\nimport type { ChildProcess } from 'child_process';\nimport _commandExists from 'command-exists';\nimport CLITable from 'cli-table3';\nimport { stringify } from 'csv-stringify';\nimport stripAnsi from 'strip-ansi';\nimport micromatch from 'micromatch';\n\n// Constants.\n\nexport const XMPContext: Record<string, string> = {\n\tdc: 'http://purl.org/dc/elements/1.1/',\n\tmodel3d: 'https://schema.khronos.org/model3d/xsd/1.0/',\n\trdf: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#',\n\txmp: 'http://ns.adobe.com/xap/1.0/',\n\txmpRights: 'http://ns.adobe.com/xap/1.0/rights/',\n};\n\n// Using 'micromatch' because 'contains: true' did not work as expected with\n// minimatch. Need to ensure that '*' matches patterns like 'image/png'.\nexport const MICROMATCH_OPTIONS = { nocase: true, contains: true };\n\n// See: https://github.com/micromatch/micromatch/issues/224\nexport function regexFromArray(values: string[]): RegExp {\n\tconst pattern = values.map((s) => `(${s})`).join('|');\n\treturn micromatch.makeRe(pattern, MICROMATCH_OPTIONS);\n}\n\n// Mocks for tests.\n\nexport let spawn = _spawn;\n// See https://github.com/mathisonian/command-exists/issues/22\nexport let commandExists = (cmd: string) => _commandExists(cmd).catch(() => false);\nexport let waitExit = _waitExit;\n\nexport function mockSpawn(_spawn: unknown): void {\n\tspawn = _spawn as typeof spawn;\n}\n\nexport function mockCommandExists(_commandExists: (n: string) => Promise<boolean>): void {\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tcommandExists = _commandExists as any;\n}\n\nexport function mockWaitExit(_waitExit: (process: ChildProcess) => Promise<[unknown, string, string]>): void {\n\twaitExit = _waitExit;\n}\n\nexport async function _waitExit(process: ChildProcess): Promise<[unknown, string, string]> {\n\tlet stdout = '';\n\tif (process.stdout) {\n\t\tfor await (const chunk of process.stdout) {\n\t\t\tstdout += chunk;\n\t\t}\n\t}\n\tlet stderr = '';\n\tif (process.stderr) {\n\t\tfor await (const chunk of process.stderr) {\n\t\t\tstderr += chunk;\n\t\t}\n\t}\n\tconst status = await new Promise((resolve, _) => {\n\t\tprocess.on('close', resolve);\n\t});\n\treturn [status, stdout, stderr];\n}\n\n// Formatting.\n\nexport function formatLong(x: number): string {\n\treturn x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n\nexport function formatBytes(bytes: number, decimals = 2): string {\n\tif (bytes === 0) return '0 Bytes';\n\n\tconst k = 1000;\n\tconst dm = decimals < 0 ? 0 : decimals;\n\tconst sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n\tconst i = Math.floor(Math.log(bytes) / Math.log(k));\n\n\treturn parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nexport function formatParagraph(str: string): string {\n\treturn str\n\t\t.match(/.{1,80}(\\s|$)/g)!\n\t\t.map((line) => line.trim())\n\t\t.join('\\n');\n}\n\nexport function formatHeader(title: string): string {\n\treturn '' + '\\n ' + title.toUpperCase() + '\\n ────────────────────────────────────────────';\n}\n\nexport enum TableFormat {\n\tPRETTY = 'pretty',\n\tCSV = 'csv',\n\tMD = 'md',\n}\n\nconst CLI_TABLE_MARKDOWN_CHARS = {\n\ttop: '',\n\t'top-mid': '',\n\t'top-left': '',\n\t'top-right': '',\n\tbottom: '',\n\t'bottom-mid': '',\n\t'bottom-left': '',\n\t'bottom-right': '',\n\tleft: '|',\n\t'left-mid': '',\n\tmid: '',\n\t'mid-mid': '',\n\tright: '|',\n\t'right-mid': '',\n\tmiddle: '|',\n};\n\nexport async function formatTable(format: TableFormat, head: string[], rows: string[][]): Promise<string> {\n\tswitch (format) {\n\t\tcase TableFormat.PRETTY: {\n\t\t\tconst table = new CLITable({ head });\n\t\t\ttable.push(...rows);\n\t\t\treturn table.toString();\n\t\t}\n\t\tcase TableFormat.CSV:\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tstringify([head, ...rows], (err, output) => {\n\t\t\t\t\terr ? reject(err) : resolve(output);\n\t\t\t\t});\n\t\t\t});\n\t\tcase TableFormat.MD: {\n\t\t\tconst table = new CLITable({ head, chars: CLI_TABLE_MARKDOWN_CHARS });\n\t\t\ttable.push(new Array(rows[0].length).fill('---'));\n\t\t\ttable.push(...rows);\n\t\t\treturn stripAnsi(table.toString());\n\t\t}\n\t}\n}\n\nexport function formatXMP(value: string | number | boolean | Record<string, unknown> | null): string {\n\tif (!value) {\n\t\treturn '';\n\t}\n\n\tif (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n\t\treturn value.toString();\n\t}\n\n\tif (value['@list']) {\n\t\tconst list = value['@list'] as string[];\n\t\tconst hasCommas = list.some((value) => value.indexOf(',') > 0);\n\t\treturn list.join(hasCommas ? '; ' : ', ');\n\t}\n\n\tif (value['@type'] === 'rdf:Alt') {\n\t\treturn (value['rdf:_1'] as Record<string, string>)['@value'];\n\t}\n\n\treturn JSON.stringify(value);\n}\n\nexport function underline(str: string): string {\n\treturn `\\x1b[4m${str}\\x1b[0m`;\n}\n\nexport function dim(str: string): string {\n\treturn `\\x1b[2m${str}\\x1b[0m`;\n}\n","import type { JSONDocument, ILogger, NodeIO, WebIO } from '@gltf-transform/core';\nimport {\n\tInspectAnimationReport,\n\tInspectMaterialReport,\n\tInspectMeshReport,\n\tInspectPropertyReport,\n\tInspectSceneReport,\n\tInspectTextureReport,\n\tinspect as inspectDoc,\n} from '@gltf-transform/functions';\nimport { formatBytes, formatHeader, formatLong, formatParagraph, formatTable, formatXMP, TableFormat } from './util.js';\nimport type { Packet } from '@gltf-transform/extensions';\n\ntype AnyPropertyReport =\n\t| InspectSceneReport\n\t| InspectMeshReport\n\t| InspectMaterialReport\n\t| InspectTextureReport\n\t| InspectAnimationReport;\n\nexport async function inspect(\n\tjsonDoc: JSONDocument,\n\tio: NodeIO | WebIO,\n\tlogger: ILogger,\n\tformat: TableFormat\n): Promise<void> {\n\t// Summary (does not require parsing).\n\tconst extensionsUsed = jsonDoc.json.extensionsUsed || [];\n\tconst extensionsRequired = jsonDoc.json.extensionsRequired || [];\n\tconsole.log(formatHeader('overview'));\n\tconsole.log(\n\t\t(await formatTable(\n\t\t\tformat,\n\t\t\t['key', 'value'],\n\t\t\t[\n\t\t\t\t['version', jsonDoc.json.asset.version],\n\t\t\t\t['generator', jsonDoc.json.asset.generator || ''],\n\t\t\t\t['extensionsUsed', extensionsUsed.join(', ') || 'none'],\n\t\t\t\t['extensionsRequired', extensionsRequired.join(', ') || 'none'],\n\t\t\t]\n\t\t)) + '\\n\\n'\n\t);\n\n\t// Parse.\n\tlet document;\n\ttry {\n\t\tdocument = await io.readJSON(jsonDoc);\n\t} catch (e) {\n\t\tlogger.warn('Unable to parse document.');\n\t\tthrow e;\n\t}\n\n\t// XMP report.\n\tconst rootPacket = document.getRoot().getExtension('KHR_xmp_json_ld') as Packet | null;\n\tif (rootPacket && rootPacket.listProperties().length > 0) {\n\t\tconsole.log(formatHeader('metadata'));\n\t\tconsole.log(\n\t\t\t(await formatTable(\n\t\t\t\tformat,\n\t\t\t\t['key', 'value'],\n\t\t\t\trootPacket.listProperties().map((name) => [name, formatXMP(rootPacket.getProperty(name)) as string])\n\t\t\t)) + '\\n\\n'\n\t\t);\n\t}\n\n\t// Detailed report.\n\tconst report = inspectDoc(document);\n\tawait reportSection('scenes', format, logger, report.scenes);\n\tawait reportSection('meshes', format, logger, report.meshes);\n\tawait reportSection('materials', format, logger, report.materials);\n\tawait reportSection('textures', format, logger, report.textures);\n\tawait reportSection('animations', format, logger, report.animations);\n}\n\nasync function reportSection(\n\ttype: string,\n\tformat: TableFormat,\n\tlogger: ILogger,\n\tsection: InspectPropertyReport<AnyPropertyReport>\n) {\n\tconst properties = section.properties;\n\n\tconsole.log(formatHeader(type));\n\tif (!properties.length) {\n\t\tconsole.log(`No ${type} found.\\n`);\n\t\treturn;\n\t}\n\n\tconst formattedRecords = properties.map((property: AnyPropertyReport, index: number) => {\n\t\treturn formatPropertyReport(property, index, format);\n\t});\n\tconst header = Object.keys(formattedRecords[0]);\n\tconst rows = formattedRecords.map((p: Record<string, string>) => Object.values(p));\n\tconst footnotes = format !== TableFormat.CSV ? getFootnotes(type, rows, header) : [];\n\tconsole.log(await formatTable(format, header, rows));\n\tif (footnotes.length) console.log('\\n' + footnotes.join('\\n'));\n\tif (section.warnings) {\n\t\tsection.warnings.forEach((warning) => logger.warn(formatParagraph(warning)));\n\t}\n\tconsole.log('\\n');\n}\n\nfunction formatPropertyReport(property: AnyPropertyReport, index: number, format: TableFormat): Record<string, string> {\n\tconst row: Record<string, string | number> = { '#': index };\n\tfor (const key in property) {\n\t\tconst value = (property as unknown as Record<string, string | number>)[key];\n\t\tif (Array.isArray(value)) {\n\t\t\trow[key] = value.join(', ');\n\t\t} else if (key.match(/size/i) && format !== TableFormat.CSV) {\n\t\t\trow[key] = (value as number) > 0 ? formatBytes(value as number) : '';\n\t\t} else if (typeof value === 'number') {\n\t\t\trow[key] = format !== TableFormat.CSV ? formatLong(value) : value;\n\t\t} else if (typeof value === 'boolean') {\n\t\t\trow[key] = value ? '✓' : '';\n\t\t} else {\n\t\t\trow[key] = value;\n\t\t}\n\t}\n\treturn row as Record<string, string>;\n}\n\nfunction getFootnotes(type: string, rows: string[][], header: string[]): string[] {\n\tconst footnotes = [];\n\tif (type === 'meshes') {\n\t\tfor (let i = 0; i < header.length; i++) {\n\t\t\tif (header[i] === 'size') header[i] += '¹';\n\t\t}\n\t\tfootnotes.push(\n\t\t\t'¹ size estimates GPU memory required by a mesh, in isolation. If accessors are\\n' +\n\t\t\t\t'  shared by other mesh primitives, but the meshes themselves are not reused, then\\n' +\n\t\t\t\t'  the sum of all mesh sizes will overestimate the asset\\'s total size. See \"dedup\".'\n\t\t);\n\t}\n\tif (type === 'textures') {\n\t\tfor (let i = 0; i < header.length; i++) {\n\t\t\tif (header[i] === 'gpuSize') header[i] += '¹';\n\t\t}\n\t\tfootnotes.push(\n\t\t\t'¹ gpuSize estimates minimum VRAM memory allocation. Older devices may require\\n' +\n\t\t\t\t'  additional memory for GPU compression formats.'\n\t\t);\n\t}\n\treturn footnotes;\n}\n","import { KHR_DF_PRIMARIES_BT709, KHR_DF_PRIMARIES_UNSPECIFIED, read, write } from 'ktx-parse';\nimport type { Document, Transform } from '@gltf-transform/core';\nimport { getTextureColorSpace, listTextureSlots } from '@gltf-transform/functions';\n\nconst NAME = 'ktxfix';\n\nexport function ktxfix(): Transform {\n\treturn async (doc: Document): Promise<void> => {\n\t\tconst logger = doc.getLogger();\n\n\t\tlet numChanged = 0;\n\n\t\tfor (const texture of doc.getRoot().listTextures()) {\n\t\t\tif (texture.getMimeType() !== 'image/ktx2') continue;\n\n\t\t\tconst image = texture.getImage();\n\t\t\tif (!image) continue;\n\n\t\t\tconst ktx = read(image);\n\t\t\tconst dfd = ktx.dataFormatDescriptor[0];\n\t\t\tconst slots = listTextureSlots(texture);\n\n\t\t\t// Don't make changes if we have no information.\n\t\t\tif (slots.length === 0) continue;\n\n\t\t\tconst colorSpace = getTextureColorSpace(texture);\n\t\t\tconst colorPrimaries = colorSpace === 'srgb' ? KHR_DF_PRIMARIES_BT709 : KHR_DF_PRIMARIES_UNSPECIFIED;\n\t\t\tconst name = texture.getURI() || texture.getName();\n\n\t\t\tlet changed = false;\n\n\t\t\t// See: https://github.com/donmccurdy/glTF-Transform/issues/218\n\t\t\tif (dfd.colorPrimaries !== colorPrimaries) {\n\t\t\t\tdfd.colorPrimaries = colorPrimaries;\n\t\t\t\tlogger.info(`${NAME}: Set colorPrimaries=${colorPrimaries} for texture \"${name}\"`);\n\t\t\t\tchanged = true;\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\ttexture.setImage(write(ktx));\n\t\t\t\tnumChanged++;\n\t\t\t}\n\t\t}\n\n\t\tlogger.info(`${NAME}: Found and repaired issues in ${numChanged} textures`);\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t};\n}\n","import fs from 'fs';\nimport {\n\tDocument,\n\tFileUtils,\n\tImageUtils,\n\tNodeIO,\n\tTransform,\n\tTexture,\n\tBuffer,\n\tPropertyType,\n} from '@gltf-transform/core';\nimport { dedup, unpartition } from '@gltf-transform/functions';\n\nconst NAME = 'merge';\n\nexport interface MergeOptions {\n\tio: NodeIO;\n\tpaths: string[];\n\tpartition?: boolean;\n\tmergeScenes?: boolean;\n}\n\nconst merge = (options: MergeOptions): Transform => {\n\tconst { paths, io } = options;\n\n\treturn async (document: Document): Promise<void> => {\n\t\tconst root = document.getRoot();\n\t\tconst logger = document.getLogger();\n\n\t\tfor (let i = 0; i < paths.length; i++) {\n\t\t\tconst path = paths[i];\n\n\t\t\tlogger.debug(`Merging ${i + 1} / ${paths.length}, ${path}`);\n\n\t\t\tconst basename = FileUtils.basename(path);\n\t\t\tconst extension = FileUtils.extension(path).toLowerCase();\n\t\t\tif (['png', 'jpg', 'jpeg', 'webp', 'ktx2'].includes(extension)) {\n\t\t\t\tdocument\n\t\t\t\t\t.createTexture(basename)\n\t\t\t\t\t.setImage(fs.readFileSync(path))\n\t\t\t\t\t.setMimeType(ImageUtils.extensionToMimeType(extension))\n\t\t\t\t\t.setURI(basename + '.' + extension);\n\t\t\t} else if (['gltf', 'glb'].includes(extension)) {\n\t\t\t\tdocument.merge(renameScenes(basename, await io.read(path)));\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Unknown file extension: \"${extension}\".`);\n\t\t\t}\n\t\t}\n\n\t\tconst rootScene = root.listScenes()[0];\n\n\t\tfor (const scene of document.getRoot().listScenes()) {\n\t\t\tif (scene === rootScene) {\n\t\t\t\troot.setDefaultScene(rootScene);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!options.mergeScenes) continue;\n\n\t\t\tfor (const child of scene.listChildren()) {\n\t\t\t\tscene.removeChild(child);\n\t\t\t\trootScene.addChild(child);\n\t\t\t}\n\n\t\t\tscene.dispose();\n\t\t}\n\n\t\t// De-duplicate textures, then ensure that all remaining textures and buffers\n\t\t// have unique URIs. See https://github.com/donmccurdy/glTF-Transform/issues/586.\n\t\tawait document.transform(dedup({ propertyTypes: [PropertyType.TEXTURE] }));\n\t\tcreateUniqueURIs(document.getRoot().listBuffers());\n\t\tcreateUniqueURIs(document.getRoot().listTextures());\n\n\t\tif (!options.partition) {\n\t\t\tawait document.transform(unpartition());\n\t\t}\n\n\t\tlogger.debug(`${NAME}: Complete.`);\n\t};\n};\n\nfunction renameScenes(name: string, document: Document): Document {\n\tconst scenes = document.getRoot().listScenes();\n\n\tfor (let i = 0; i < scenes.length; i++) {\n\t\tif (!scenes[i].getName()) {\n\t\t\tscenes[i].setName(name + (scenes.length > 1 ? ` (${i + 1}/${scenes.length})` : ''));\n\t\t}\n\t}\n\n\treturn document;\n}\n\n/** Replaces conflicting URIs to ensure all URIs are unique. */\nfunction createUniqueURIs(resources: Buffer[] | Texture[]): void {\n\tconst total = {} as Record<string, number>;\n\tconst used = {} as Record<string, boolean>;\n\n\tfor (const resource of resources) {\n\t\tconst uri = resource.getURI();\n\t\tif (!uri) continue;\n\t\tif (!total[uri]) total[uri] = 0;\n\t\ttotal[uri]++;\n\t\tused[uri] = false;\n\t}\n\n\tfor (const resource of resources) {\n\t\tlet uri = resource.getURI();\n\t\tif (!uri || total[uri] === 1) continue;\n\n\t\tconst extension = FileUtils.extension(uri);\n\t\tconst prefix = uri.replace(new RegExp(`\\\\.${extension}`), '');\n\t\tfor (let i = 2; used[uri]; i++) {\n\t\t\turi = `${prefix}_${i++}.${extension}`;\n\t\t}\n\t\tresource.setURI(uri);\n\t\tused[uri] = true;\n\t}\n}\n\nexport { merge };\n","import fs from 'fs/promises';\nimport { existsSync, mkdirSync } from 'fs';\nimport { join } from 'path';\nimport micromatch from 'micromatch';\nimport os from 'os';\nimport semver from 'semver';\nimport tmp from 'tmp';\nimport pLimit from 'p-limit';\n\nimport {\n\tDocument,\n\tFileUtils,\n\tILogger,\n\tImageUtils,\n\tTextureChannel,\n\tTransform,\n\tvec2,\n\tuuid,\n\tTexture,\n} from '@gltf-transform/core';\nimport { KHRTextureBasisu } from '@gltf-transform/extensions';\nimport {\n\tcreateTransform,\n\tgetTextureChannelMask,\n\tgetTextureColorSpace,\n\tlistTextureSlots,\n} from '@gltf-transform/functions';\nimport { spawn, commandExists, formatBytes, waitExit, MICROMATCH_OPTIONS } from '../util.js';\n\ntmp.setGracefulCleanup();\n\nconst NUM_CPUS = os.cpus().length || 1; // microsoft/vscode#112122\nconst KTX_SOFTWARE_VERSION_MIN = '4.0.0-rc1';\nconst KTX_SOFTWARE_VERSION_ACTIVE = '4.1.0-rc1';\n\nconst { R, G } = TextureChannel;\n\n/**********************************************************************************************\n * Interfaces.\n */\n\nexport const Mode = {\n\tETC1S: 'etc1s',\n\tUASTC: 'uastc',\n};\n\nexport const Filter = {\n\tBOX: 'box',\n\tTENT: 'tent',\n\tBELL: 'bell',\n\tBSPLINE: 'b-spline',\n\tMITCHELL: 'mitchell',\n\tLANCZOS3: 'lanczos3',\n\tLANCZOS4: 'lanczos4',\n\tLANCZOS6: 'lanczos6',\n\tLANCZOS12: 'lanczos12',\n\tBLACKMAN: 'blackman',\n\tKAISER: 'kaiser',\n\tGAUSSIAN: 'gaussian',\n\tCATMULLROM: 'catmullrom',\n\tQUADRATIC_INTERP: 'quadratic_interp',\n\tQUADRATIC_APPROX: 'quadratic_approx',\n\tQUADRATIC_MIX: 'quadratic_mix',\n};\n\ninterface GlobalOptions {\n\tmode: string;\n\t/** Pattern identifying textures to compress, matched to name or URI. */\n\tpattern?: RegExp | null;\n\t/**\n\t * Pattern matching the material texture slot(s) to be compressed or converted.\n\t * Passing a string (glob) is deprecated; use a RegExp instead.\n\t */\n\tslots?: RegExp | string | null;\n\tfilter?: string;\n\tfilterScale?: number;\n\tresize?: vec2;\n\tpowerOfTwo?: boolean;\n\tjobs?: number;\n}\n\nexport interface ETC1SOptions extends GlobalOptions {\n\tquality?: number;\n\tcompression?: number;\n\tmaxEndpoints?: number;\n\tmaxSelectors?: number;\n\trdoOff?: boolean;\n\trdoThreshold?: number;\n}\n\nexport interface UASTCOptions extends GlobalOptions {\n\tlevel?: number;\n\trdo?: number;\n\trdoDictionarySize?: number;\n\trdoBlockScale?: number;\n\trdoStdDev?: number;\n\trdoMultithreading?: boolean;\n\tzstd?: number;\n}\n\nconst GLOBAL_DEFAULTS: Omit<GlobalOptions, 'mode'> = {\n\tfilter: Filter.LANCZOS4,\n\tfilterScale: 1,\n\tpowerOfTwo: false,\n\tpattern: null,\n\tslots: null,\n\t// See: https://github.com/donmccurdy/glTF-Transform/pull/389#issuecomment-1089842185\n\tjobs: 2 * NUM_CPUS,\n};\n\nexport const ETC1S_DEFAULTS: Omit<ETC1SOptions, 'mode'> = {\n\tquality: 128,\n\tcompression: 1,\n\t...GLOBAL_DEFAULTS,\n};\n\nexport const UASTC_DEFAULTS: Omit<UASTCOptions, 'mode'> = {\n\tlevel: 2,\n\trdo: 0,\n\trdoDictionarySize: 32768,\n\trdoBlockScale: 10.0,\n\trdoStdDev: 18.0,\n\trdoMultithreading: true,\n\tzstd: 18,\n\t...GLOBAL_DEFAULTS,\n};\n\n/**********************************************************************************************\n * Implementation.\n */\n\nexport const toktx = function (options: ETC1SOptions | UASTCOptions): Transform {\n\toptions = {\n\t\t...(options.mode === Mode.ETC1S ? ETC1S_DEFAULTS : UASTC_DEFAULTS),\n\t\t...options,\n\t};\n\n\treturn createTransform(options.mode, async (doc: Document): Promise<void> => {\n\t\tconst logger = doc.getLogger();\n\n\t\t// Confirm recent version of KTX-Software is installed.\n\t\tconst version = await checkKTXSoftware(logger);\n\n\t\t// Create workspace.\n\t\tconst batchPrefix = uuid();\n\t\tconst batchDir = join(tmp.tmpdir, 'gltf-transform');\n\t\tif (!existsSync(batchDir)) mkdirSync(batchDir);\n\n\t\tconst basisuExtension = doc.createExtension(KHRTextureBasisu).setRequired(true);\n\n\t\tlet numCompressed = 0;\n\n\t\tconst limit = pLimit(options.jobs!);\n\t\tconst textures = doc.getRoot().listTextures();\n\t\tconst numTextures = textures.length;\n\t\tconst promises = textures.map((texture, textureIndex) =>\n\t\t\tlimit(async () => {\n\t\t\t\tconst slots = listTextureSlots(texture);\n\t\t\t\tconst channels = getTextureChannelMask(texture);\n\t\t\t\tconst textureLabel =\n\t\t\t\t\ttexture.getURI() ||\n\t\t\t\t\ttexture.getName() ||\n\t\t\t\t\t`${textureIndex + 1}/${doc.getRoot().listTextures().length}`;\n\t\t\t\tconst prefix = `toktx:texture(${textureLabel})`;\n\t\t\t\tlogger.debug(`${prefix}: Slots → [${slots.join(', ')}]`);\n\n\t\t\t\t// FILTER: Exclude textures that don't match (a) 'slots' or (b) expected formats.\n\n\t\t\t\tif (typeof options.slots === 'string') {\n\t\t\t\t\toptions.slots = micromatch.makeRe(options.slots, MICROMATCH_OPTIONS);\n\t\t\t\t\tlogger.warn('toktx: Argument \"slots\" should be of type `RegExp | null`.');\n\t\t\t\t}\n\n\t\t\t\tconst patternRe = options.pattern as RegExp | null;\n\t\t\t\tconst slotsRe = options.slots as RegExp | null;\n\n\t\t\t\tif (texture.getMimeType() === 'image/ktx2') {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, already KTX.`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (texture.getMimeType() !== 'image/png' && texture.getMimeType() !== 'image/jpeg') {\n\t\t\t\t\tlogger.warn(`${prefix}: Skipping, unsupported texture type \"${texture.getMimeType()}\".`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (slotsRe && !slots.find((slot) => slot.match(slotsRe))) {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, [${slots.join(', ')}] excluded by \"slots\" parameter.`);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (patternRe && !(texture.getURI().match(patternRe) || texture.getName().match(patternRe))) {\n\t\t\t\t\tlogger.debug(`${prefix}: Skipping, excluded by \"pattern\" parameter.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst image = texture.getImage();\n\t\t\t\tconst size = options.resize || texture.getSize();\n\t\t\t\tif (!image || !size) {\n\t\t\t\t\tlogger.warn(`${prefix}: Skipping, unreadable texture.`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// PREPARE: Create temporary in/out paths for the 'toktx' CLI tool, and determine\n\t\t\t\t// necessary command-line flags.\n\n\t\t\t\tconst extension = texture.getURI()\n\t\t\t\t\t? FileUtils.extension(texture.getURI())\n\t\t\t\t\t: ImageUtils.mimeTypeToExtension(texture.getMimeType());\n\n\t\t\t\tconst inPath = join(batchDir, `${batchPrefix}_${textureIndex}.${extension}`);\n\t\t\t\tconst outPath = join(batchDir, `${batchPrefix}_${textureIndex}.ktx2`);\n\n\t\t\t\tconst inBytes = image.byteLength;\n\t\t\t\tawait fs.writeFile(inPath, Buffer.from(image));\n\n\t\t\t\tconst params = [\n\t\t\t\t\t...createParams(texture, slots, channels, size, logger, numTextures, options, version),\n\t\t\t\t\toutPath,\n\t\t\t\t\tinPath,\n\t\t\t\t];\n\t\t\t\tlogger.debug(`${prefix}: Spawning → toktx ${params.join(' ')}`);\n\n\t\t\t\t// COMPRESS: Run `toktx` CLI tool.\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\t\t\t\tconst [status, stdout, stderr] = await waitExit(spawn('toktx', params as string[]));\n\n\t\t\t\tif (status !== 0) {\n\t\t\t\t\tlogger.error(`${prefix}: Failed → \\n\\n${stderr.toString()}`);\n\t\t\t\t} else {\n\t\t\t\t\t// PACK: Replace image data in the glTF asset.\n\n\t\t\t\t\ttexture.setImage(await fs.readFile(outPath)).setMimeType('image/ktx2');\n\n\t\t\t\t\tif (texture.getURI()) {\n\t\t\t\t\t\ttexture.setURI(FileUtils.basename(texture.getURI()) + '.ktx2');\n\t\t\t\t\t}\n\n\t\t\t\t\tnumCompressed++;\n\t\t\t\t}\n\n\t\t\t\tconst outBytes = texture.getImage()!.byteLength;\n\t\t\t\tlogger.debug(`${prefix}: ${formatBytes(inBytes)} → ${formatBytes(outBytes)} bytes`);\n\t\t\t})\n\t\t);\n\n\t\tawait Promise.all(promises);\n\n\t\tif (numCompressed === 0) {\n\t\t\tlogger.warn('toktx: No textures were found, or none were selected for compression.');\n\t\t}\n\n\t\tconst usesKTX2 = doc\n\t\t\t.getRoot()\n\t\t\t.listTextures()\n\t\t\t.some((t) => t.getMimeType() === 'image/ktx2');\n\n\t\tif (!usesKTX2) {\n\t\t\tbasisuExtension.dispose();\n\t\t}\n\t});\n};\n\n/**********************************************************************************************\n * Utilities.\n */\n\n/** Create CLI parameters from the given options. Attempts to write only non-default options. */\nfunction createParams(\n\ttexture: Texture,\n\tslots: string[],\n\tchannels: number,\n\tsize: vec2,\n\tlogger: ILogger,\n\tnumTextures: number,\n\toptions: ETC1SOptions | UASTCOptions,\n\tversion: string\n): (string | number)[] {\n\tconst params: (string | number)[] = [];\n\tparams.push('--genmipmap');\n\tif (options.filter !== GLOBAL_DEFAULTS.filter) params.push('--filter', options.filter!);\n\tif (options.filterScale !== GLOBAL_DEFAULTS.filterScale) {\n\t\tparams.push('--fscale', options.filterScale!);\n\t}\n\n\tif (options.mode === Mode.UASTC) {\n\t\tconst _options = options as UASTCOptions;\n\t\tparams.push('--uastc', _options.level!);\n\t\tif (_options.rdo !== UASTC_DEFAULTS.rdo) {\n\t\t\tparams.push('--uastc_rdo_l', _options.rdo!);\n\t\t}\n\t\tif (_options.rdoDictionarySize !== UASTC_DEFAULTS.rdoDictionarySize) {\n\t\t\tparams.push('--uastc_rdo_d', _options.rdoDictionarySize!);\n\t\t}\n\t\tif (_options.rdoBlockScale !== UASTC_DEFAULTS.rdoBlockScale) {\n\t\t\tparams.push('--uastc_rdo_b', _options.rdoBlockScale!);\n\t\t}\n\t\tif (_options.rdoStdDev !== UASTC_DEFAULTS.rdoStdDev) {\n\t\t\tparams.push('--uastc_rdo_s', _options.rdoStdDev!);\n\t\t}\n\t\tif (!_options.rdoMultithreading) {\n\t\t\tparams.push('--uastc_rdo_m');\n\t\t}\n\t\tif (_options.zstd && _options.zstd > 0) params.push('--zcmp', _options.zstd);\n\t} else {\n\t\tconst _options = options as ETC1SOptions;\n\t\tparams.push('--bcmp');\n\t\tif (_options.quality !== ETC1S_DEFAULTS.quality) {\n\t\t\tparams.push('--qlevel', _options.quality!);\n\t\t}\n\t\tif (_options.compression !== ETC1S_DEFAULTS.compression) {\n\t\t\tparams.push('--clevel', _options.compression!);\n\t\t}\n\t\tif (_options.maxEndpoints) params.push('--max_endpoints', _options.maxEndpoints);\n\t\tif (_options.maxSelectors) params.push('--max_selectors', _options.maxSelectors);\n\n\t\tif (_options.rdoOff) {\n\t\t\tparams.push('--no_endpoint_rdo', '--no_selector_rdo');\n\t\t} else if (_options.rdoThreshold) {\n\t\t\tparams.push('--endpoint_rdo_threshold', _options.rdoThreshold);\n\t\t\tparams.push('--selector_rdo_threshold', _options.rdoThreshold);\n\t\t}\n\t}\n\n\tif (slots.find((slot) => micromatch.isMatch(slot, '*normal*', MICROMATCH_OPTIONS))) {\n\t\t// See: https://github.com/KhronosGroup/KTX-Software/issues/600\n\t\tif (semver.gte(version, KTX_SOFTWARE_VERSION_ACTIVE)) {\n\t\t\tparams.push('--normal_mode', '--input_swizzle', 'rgb1');\n\t\t} else if (options.mode === Mode.ETC1S) {\n\t\t\tparams.push('--normal_map');\n\t\t}\n\t}\n\n\tif (slots.length && getTextureColorSpace(texture) !== 'srgb') {\n\t\t// See: https://github.com/donmccurdy/glTF-Transform/issues/215\n\t\tparams.push('--assign_oetf', 'linear', '--assign_primaries', 'none');\n\t}\n\n\tif (channels === R) {\n\t\tparams.push('--target_type', 'R');\n\t} else if (channels === G || channels === (R | G)) {\n\t\tparams.push('--target_type', 'RG');\n\t}\n\n\t// Minimum size on any dimension is 4px.\n\t// See: https://github.com/donmccurdy/glTF-Transform/issues/502\n\n\tlet width: number;\n\tlet height: number;\n\tif (options.powerOfTwo) {\n\t\twidth = preferredPowerOfTwo(size[0]);\n\t\theight = preferredPowerOfTwo(size[1]);\n\t} else {\n\t\tif (!isPowerOfTwo(size[0]) || !isPowerOfTwo(size[1])) {\n\t\t\tlogger.warn(\n\t\t\t\t`toktx: Texture dimensions ${size[0]}x${size[1]} are NPOT, and may` +\n\t\t\t\t\t' fail in older APIs (including WebGL 1.0) on certain devices.'\n\t\t\t);\n\t\t}\n\t\twidth = isMultipleOfFour(size[0]) ? size[0] : ceilMultipleOfFour(size[0]);\n\t\theight = isMultipleOfFour(size[1]) ? size[1] : ceilMultipleOfFour(size[1]);\n\t}\n\n\tif (width !== size[0] || height !== size[1] || options.resize) {\n\t\tif (width > 4096 || height > 4096) {\n\t\t\tlogger.warn(\n\t\t\t\t`toktx: Resizing to nearest power of two, ${width}x${height}px. Texture dimensions` +\n\t\t\t\t\t' greater than 4096px may not render on some mobile devices.' +\n\t\t\t\t\t' Resize to a lower resolution before compressing, if needed.'\n\t\t\t);\n\t\t}\n\t\tparams.push('--resize', `${width}x${height}`);\n\t}\n\n\tif (options.jobs && options.jobs > 1 && numTextures > 1) {\n\t\t// See: https://github.com/donmccurdy/glTF-Transform/pull/389#issuecomment-1089842185\n\t\tconst threads = Math.max(2, Math.min(NUM_CPUS, (3 * NUM_CPUS) / numTextures));\n\t\tparams.push('--threads', threads);\n\t}\n\n\treturn params;\n}\n\nasync function checkKTXSoftware(logger: ILogger): Promise<string> {\n\tif (!(await commandExists('toktx')) && !process.env.CI) {\n\t\tthrow new Error(\n\t\t\t'Command \"toktx\" not found. Please install KTX-Software, from:\\n\\nhttps://github.com/KhronosGroup/KTX-Software'\n\t\t);\n\t}\n\n\tconst [status, stdout, stderr] = await waitExit(spawn('toktx', ['--version']));\n\n\tconst version = ((stdout || stderr) as string)\n\t\t.replace(/toktx\\s+/, '')\n\t\t.replace(/~\\d+/, '')\n\t\t.trim();\n\n\tif (status !== 0 || !semver.valid(semver.clean(version))) {\n\t\tthrow new Error('Unable to find \"toktx\" version. Confirm KTX-Software is installed.');\n\t} else if (semver.lt(semver.clean(version)!, KTX_SOFTWARE_VERSION_MIN)) {\n\t\tlogger.warn(`toktx: Expected KTX-Software >= v${KTX_SOFTWARE_VERSION_MIN}, found ${version}.`);\n\t} else {\n\t\tlogger.debug(`toktx: Found KTX-Software ${version}.`);\n\t}\n\n\treturn semver.clean(version)!;\n}\n\nfunction isPowerOfTwo(value: number): boolean {\n\tif (value <= 2) return true;\n\treturn (value & (value - 1)) === 0 && value !== 0;\n}\n\nfunction preferredPowerOfTwo(value: number): number {\n\tif (value <= 4) return 4;\n\n\tconst lo = floorPowerOfTwo(value);\n\tconst hi = ceilPowerOfTwo(value);\n\n\tif (hi - value > value - lo) return lo;\n\treturn hi;\n}\n\nfunction floorPowerOfTwo(value: number): number {\n\treturn Math.pow(2, Math.floor(Math.log(value) / Math.LN2));\n}\n\nfunction ceilPowerOfTwo(value: number): number {\n\treturn Math.pow(2, Math.ceil(Math.log(value) / Math.LN2));\n}\n\nfunction isMultipleOfFour(value: number): boolean {\n\treturn value % 4 === 0;\n}\n\nfunction ceilMultipleOfFour(value: number): number {\n\tif (value <= 4) return 4;\n\treturn value % 4 ? value + 4 - (value % 4) : value;\n}\n","import type { Document, ILogger, Transform } from '@gltf-transform/core';\nimport { Packet, KHRXMP } from '@gltf-transform/extensions';\nimport inquirer, { Question, QuestionCollection } from 'inquirer';\nimport languageTags from 'language-tags';\nimport validateSPDX from 'spdx-correct';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { formatXMP, XMPContext } from '../util.js';\n\nconst DEFAULT_LANG = 'en-US';\n\nexport interface XMPOptions {\n\tpacket?: string;\n\treset?: boolean;\n}\n\nexport const XMP_DEFAULTS = {\n\tpacket: '',\n\treset: false,\n};\n\nenum Prompt {\n\tCREATOR,\n\tDESCRIPTION,\n\tLANGUAGE,\n\tTITLE,\n\tRELATED,\n\tPREFERRED_SURFACE,\n\tCREATE_DATE,\n\tRIGHTS,\n}\n\nasync function* generateQuestions(results: Record<string, unknown>): AsyncGenerator<Question> {\n\tlet lang = (results['dc:language'] as string) || DEFAULT_LANG;\n\n\tyield {\n\t\ttype: 'checkbox',\n\t\tname: '_prompts',\n\t\tmessage: 'Select XMP metadata:',\n\t\tloop: false,\n\t\tpageSize: 15,\n\t\tchoices: [\n\t\t\t{ value: Prompt.CREATOR, name: 'Creator' },\n\t\t\t{ value: Prompt.TITLE, name: 'Title' },\n\t\t\t{ value: Prompt.DESCRIPTION, name: 'Description' },\n\t\t\t{ value: Prompt.RELATED, name: 'Related links' },\n\t\t\tnew inquirer.Separator(),\n\t\t\t{ value: Prompt.CREATE_DATE, name: 'Date created' },\n\t\t\tnew inquirer.Separator(),\n\t\t\t{ value: Prompt.LANGUAGE, name: 'Language' },\n\t\t\tnew inquirer.Separator(),\n\t\t\t{ value: Prompt.RIGHTS, name: 'License and rights' },\n\t\t\tnew inquirer.Separator(),\n\t\t\t{ value: Prompt.PREFERRED_SURFACE, name: 'Preferred surfaces (AR)' },\n\t\t],\n\t} as Question;\n\n\tconst prompts = new Set<Prompt>(results._prompts as Prompt[]);\n\n\t// Prompt for 'dc:language' first, used as the default for Language Alternative entries.\n\tif (prompts.has(Prompt.LANGUAGE)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'dc:language',\n\t\t\tmessage: 'Language?',\n\t\t\tsuffix: ' (dc:language)',\n\t\t\tvalidate: (input: string) =>\n\t\t\t\tlanguageTags.check(input) ? true : 'Invalid language; refer to IETF RFC 3066.',\n\t\t\tdefault: DEFAULT_LANG,\n\t\t};\n\n\t\tlang = results['dc:language'] as string;\n\t}\n\n\tif (prompts.has(Prompt.CREATOR)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'dc:creator',\n\t\t\tmessage: 'Creator of the model?',\n\t\t\tsuffix: ' (dc:creator)',\n\t\t\tfilter: (input: string) => createList([input]),\n\t\t\ttransformer: formatXMP,\n\t\t} as Question;\n\t}\n\n\tif (prompts.has(Prompt.TITLE)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'dc:title',\n\t\t\tmessage: 'Title of the model?',\n\t\t\tsuffix: ' (dc:title)',\n\t\t\tfilter: (input: string) => createLanguageAlternative(input, lang),\n\t\t\ttransformer: formatXMP,\n\t\t} as Question;\n\t}\n\n\tif (prompts.has(Prompt.DESCRIPTION)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'dc:description',\n\t\t\tmessage: 'Description of the model?',\n\t\t\tsuffix: ' (dc:description)',\n\t\t\tfilter: (input: string) => createLanguageAlternative(input, lang),\n\t\t\ttransformer: formatXMP,\n\t\t} as Question;\n\t}\n\n\tif (prompts.has(Prompt.RELATED)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'dc:relation',\n\t\t\tmessage: 'Related links?',\n\t\t\tsuffix: ' Comma-separated URLs. (dc:relation)',\n\t\t\tfilter: (input: string) => createList(input.split(/[,\\n]/).map((url) => url.trim())),\n\t\t\ttransformer: formatXMP,\n\t\t} as Question;\n\t}\n\n\tif (prompts.has(Prompt.RIGHTS)) {\n\t\tyield {\n\t\t\ttype: 'list',\n\t\t\tname: '_rights',\n\t\t\tmessage: 'Is the model rights-managed?',\n\t\t\tsuffix: ' (dc:rights, xmpRights:Marked, model3d:spdxLicense)',\n\t\t\tloop: false,\n\t\t\tpageSize: 15,\n\t\t\tchoices: [\n\t\t\t\t// Common SPDX license identifiers applicable to creative works.\n\t\t\t\t{ value: '', name: 'Unspecified' },\n\t\t\t\t{ value: 'UNLICENSED', name: 'Restricted by copyright, trademark, or other marking' },\n\t\t\t\t{ value: 'CC0-1.0', name: 'Public domain (CC0-1.0)' },\n\t\t\t\t{ value: 'CC-BY-4.0', name: 'Creative Commons Attribution (CC-BY-4.0)' },\n\t\t\t\t{ value: 'CC-BY-ND-4.0', name: 'Creative Commons Attribution-NoDerivs (CC-BY-ND-4.0)' },\n\t\t\t\t{ value: 'CC-BY-SA-4.0', name: 'Creative Commons Attribution-ShareAlike (CC-BY-SA-4.0)' },\n\t\t\t\t{ value: 'CC-BY-NC-4.0', name: 'Creative Commons Attribution-NonCommercial (CC-BY-NC-4.0)' },\n\t\t\t\t{\n\t\t\t\t\tvalue: 'CC-BY-NC-ND-4.0',\n\t\t\t\t\tname: 'Creative Commons Attribution-NonCommercial-NoDerivs (CC-BY-NC-ND-4.0)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: 'CC-BY-NC-SA-4.0',\n\t\t\t\t\tname: 'Creative Commons Attribution-NonCommercial-ShareAlike (CC-BY-NC-SA-4.0)',\n\t\t\t\t},\n\t\t\t\t{ value: 'OTHER', name: 'Other license' },\n\t\t\t],\n\t\t} as Question;\n\n\t\tif (results._rights === 'UNLICENSED') {\n\t\t\tresults['xmpRights:Marked'] = true;\n\n\t\t\tyield {\n\t\t\t\ttype: 'input',\n\t\t\t\tname: 'xmpRights:Owner',\n\t\t\t\tmessage: 'Who is the intellectual property (IP) owner?',\n\t\t\t\tsuffix: ' (xmpRights:Owner)',\n\t\t\t\tfilter: (input: string) => createList([input]),\n\t\t\t\ttransformer: formatXMP,\n\t\t\t} as Question;\n\n\t\t\tyield {\n\t\t\t\ttype: 'input',\n\t\t\t\tname: '_usage',\n\t\t\t\tmessage: 'Other usage instructions?',\n\t\t\t\tsuffix: ' Plain text or URL. (xmpRights:UsageTerms, xmpRights:WebStatement)',\n\t\t\t};\n\n\t\t\tconst usage = results._usage as string;\n\t\t\tif (/^https?:\\/\\//.test(usage)) {\n\t\t\t\tresults['xmpRights:WebStatement'] = usage;\n\t\t\t} else if (usage) {\n\t\t\t\tresults['xmpRights:UsageTerms'] = createLanguageAlternative(usage, lang);\n\t\t\t}\n\t\t}\n\n\t\tif (results._rights === 'OTHER') {\n\t\t\tyield {\n\t\t\t\ttype: 'confirm',\n\t\t\t\tname: '_isLicenseSPDX',\n\t\t\t\tmessage: 'Does the license have an SPDX ID?',\n\t\t\t\tsuffix: ' See https://spdx.dev/.',\n\t\t\t};\n\n\t\t\tif (results._isLicenseSPDX) {\n\t\t\t\tyield {\n\t\t\t\t\ttype: 'input',\n\t\t\t\t\tname: 'model3d:spdxLicense',\n\t\t\t\t\tmessage: 'What is the SPDX license ID?',\n\t\t\t\t\tsuffix: ' (model3d:spdxLicense)',\n\t\t\t\t\tvalidate: (input: string) =>\n\t\t\t\t\t\tvalidateSPDX(input) ? true : 'Invalid SPDX ID; refer to https://spdx.dev/.',\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tyield {\n\t\t\t\t\ttype: 'input',\n\t\t\t\t\tname: 'dc:rights',\n\t\t\t\t\tmessage: 'What is the plain text license or rights statement?',\n\t\t\t\t\tsuffix: ' (dc:rights)',\n\t\t\t\t\tfilter: (input: string) => createLanguageAlternative(input, lang),\n\t\t\t\t\ttransformer: formatXMP,\n\t\t\t\t} as Question;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (prompts.has(Prompt.CREATE_DATE)) {\n\t\tyield {\n\t\t\ttype: 'input',\n\t\t\tname: 'xmp:CreateDate',\n\t\t\tmessage: 'Date created?',\n\t\t\tsuffix: ' (xmp:CreateDate)',\n\t\t\tdefault: new Date().toISOString().substring(0, 10),\n\t\t\tvalidate: validateDate,\n\t\t};\n\t}\n\n\tif (prompts.has(Prompt.PREFERRED_SURFACE)) {\n\t\tyield {\n\t\t\ttype: 'checkbox',\n\t\t\tname: 'model3d:preferredSurfaces',\n\t\t\tmessage: 'Preferred surfaces for augmented reality (AR)? Select all that apply.',\n\t\t\tsuffix: ' (model3d:preferredSurfaces)',\n\t\t\tloop: false,\n\t\t\tpageSize: 15,\n\t\t\tchoices: [\n\t\t\t\t{\n\t\t\t\t\tvalue: 'horizontal_up',\n\t\t\t\t\tshort: 'horizontal_up',\n\t\t\t\t\tname: 'horizontal_up (rests on top of horizontal surfaces)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: 'horizontal_down',\n\t\t\t\t\tshort: 'horizontal_down',\n\t\t\t\t\tname: 'horizontal_down (suspended from horizonal surfaces)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: 'vertical',\n\t\t\t\t\tshort: 'vertical',\n\t\t\t\t\tname: 'vertical (attaches to vertical surfaces)',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: 'human_face',\n\t\t\t\t\tshort: 'human_face',\n\t\t\t\t\tname: 'human_face (worn or displayed on a human face)',\n\t\t\t\t},\n\t\t\t],\n\t\t\tfilter: (input: string[]) => createList(input),\n\t\t\ttransformer: formatXMP,\n\t\t} as Question;\n\t}\n}\n\nexport const xmp = (_options: XMPOptions = XMP_DEFAULTS): Transform => {\n\tconst options = { ...XMP_DEFAULTS, ..._options } as Required<XMPOptions>;\n\n\treturn async (document: Document): Promise<void> => {\n\t\tconst logger = document.getLogger();\n\t\tconst root = document.getRoot();\n\t\tconst xmpExtension = document.createExtension(KHRXMP);\n\n\t\tif (options.reset) {\n\t\t\txmpExtension.dispose();\n\t\t\tlogger.info('[xmp]: Reset XMP metadata.');\n\t\t\tlogger.debug('[xmp]: Complete.');\n\t\t\treturn;\n\t\t}\n\n\t\tif (options.packet) {\n\t\t\tconst packetPath = path.resolve(options.packet);\n\t\t\tlogger.info(`[xmp]: Loading \"${packetPath}\"...`);\n\t\t\tconst packetJSON = await fs.readFile(packetPath, 'utf-8');\n\t\t\tconst packetDef = validatePacket(JSON.parse(packetJSON));\n\t\t\tconst packet = xmpExtension.createPacket().fromJSONLD(packetDef);\n\t\t\troot.setExtension('KHR_xmp_json_ld', packet);\n\t\t\tlogger.debug('[xmp]: Complete.');\n\t\t\treturn;\n\t\t}\n\n\t\tconst packet = root.getExtension<Packet>('KHR_xmp_json_ld') || xmpExtension.createPacket();\n\t\tconst results = packet.toJSONLD();\n\n\t\ttry {\n\t\t\tfor await (const question of generateQuestions(results)) {\n\t\t\t\tObject.assign(results, await inquirer.prompt(question as QuestionCollection));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tcheckTTY(e, logger);\n\t\t\tthrow e;\n\t\t}\n\n\t\t// Context.\n\t\tpacket.setContext({\n\t\t\t...packet.getContext(),\n\t\t\t...createContext(results),\n\t\t\txmp: XMPContext.xmp, // required for xmp:MetadataDate below.\n\t\t});\n\n\t\t// Properties.\n\t\tlet numProperties = 0;\n\t\tfor (const name in results) {\n\t\t\t// NOTICE: Calling 'continue' in this context hits a Babel bug.\n\t\t\tif (!name.startsWith('_') && !name.startsWith('@') && results[name]) {\n\t\t\t\tpacket.setProperty(name, results[name] as string);\n\t\t\t\tnumProperties++;\n\t\t\t}\n\t\t}\n\n\t\tif (numProperties === 0) {\n\t\t\tthrow new Error('xmp: No properties added.');\n\t\t}\n\n\t\t// xmp:MetadataDate should be the same as, or more recent than, xmp:ModifyDate.\n\t\tpacket.setProperty('xmp:MetadataDate', new Date().toISOString().substring(0, 10));\n\n\t\troot.setExtension('KHR_xmp_json_ld', packet);\n\n\t\tlogger.debug(`[xmp]: Packet contents: ${JSON.stringify(packet.toJSONLD(), null, 2)}`);\n\t\tlogger.debug('[xmp]: Complete.');\n\t};\n};\n\n/** Validates a JSON-LD XMP packet for basic expectations. */\nfunction validatePacket(packetDef: Record<string, unknown>): Record<string, unknown> {\n\t// Check context.\n\tconst context = packetDef['@context'] as Record<string, unknown>;\n\tif (!context) {\n\t\tthrow new Error('Missing @context in packet.');\n\t}\n\n\t// Check properties.\n\tfor (const name in packetDef) {\n\t\tif (name.startsWith('@')) continue;\n\n\t\tconst prefix = name.split(':')[0];\n\t\tif (!prefix) {\n\t\t\tthrow new Error(`Invalid property, \"${name}\"`);\n\t\t}\n\t\tif (!(prefix in context)) {\n\t\t\tthrow new Error(`Missing context definition, \"${prefix}\"`);\n\t\t}\n\t}\n\n\treturn packetDef;\n}\n\n/**\n * The 'inquirer' library supports most terminal clients, but won't run in non-interactive\n * environments. Check errors and try to provide a useful warning to the user.\n * See: https://github.com/SBoudrias/Inquirer.js#Support.\n */\nfunction checkTTY(error: unknown, logger: ILogger) {\n\tif ((error as { isTtyError?: boolean }).isTtyError) {\n\t\tlogger.warn(\n\t\t\t'Unable to run \"inquirer\" session in this terminal environment.' +\n\t\t\t\t' Try another terminal or provide a --packet JSON-LD input.'\n\t\t);\n\t}\n}\n\n/** Creates a Language Alternative entry with a single language. */\nfunction createLanguageAlternative(value: string, language: string): Record<string, unknown> | null {\n\tif (!value) return null;\n\treturn {\n\t\t'@type': 'rdf:Alt',\n\t\t'rdf:_1': {\n\t\t\t'@language': language,\n\t\t\t'@value': value,\n\t\t},\n\t};\n}\n\n/** Creates a List entry. */\nfunction createList(list: string[]): Record<string, unknown> | null {\n\tlist = list.filter((value) => !!value);\n\tif (!list.length) return null;\n\treturn { '@list': list };\n}\n\nfunction validateDate(input: string): boolean | string {\n\tconst [date] = input.split('T');\n\n\tif (!/\\d{4}-\\d{2}-\\d{2}/.test(date) || new Date(date).toISOString().substring(0, 10) !== date) {\n\t\treturn 'Invalid ISO date string.';\n\t}\n\n\treturn true;\n}\n\nfunction createContext(_object: unknown, acc: Record<string, string> = {}): Record<string, string> {\n\tif (Object.prototype.toString.call(_object) !== '[object Object]') return acc;\n\n\tconst object = _object as Record<string, unknown>;\n\tfor (const key in object) {\n\t\tconst value = object[key];\n\t\tconst [prefix, suffix] = key.split(':');\n\t\tif (prefix && suffix && prefix in XMPContext) {\n\t\t\tacc[prefix] = XMPContext[prefix];\n\t\t\tcreateContext(value, acc);\n\t\t}\n\t}\n\n\treturn acc;\n}\n","import { Document, NodeIO, FileUtils, Transform, Format, Verbosity } from '@gltf-transform/core';\nimport type { Packet, KHRXMP } from '@gltf-transform/extensions';\nimport { unpartition } from '@gltf-transform/functions';\nimport { Listr, ListrTask } from 'listr2';\nimport { dim, formatBytes, formatLong, XMPContext } from './util.js';\nimport { performance } from 'perf_hooks'; // global in Node.js v16+\nimport { Logger } from './program.js';\n\n/** Helper class for managing a CLI command session. */\nexport class Session {\n\tprivate _outputFormat: Format;\n\tprivate _display = false;\n\n\tconstructor(\n\t\tprivate _io: NodeIO,\n\t\tprivate _logger: Logger,\n\t\tprivate _input: string,\n\t\tprivate _output: string,\n\t) {\n\t\t_io.setLogger(_logger);\n\t\tthis._outputFormat = FileUtils.extension(_output) === 'glb' ? Format.GLB : Format.GLTF;\n\t}\n\n\tpublic static create(io: NodeIO, logger: Logger, input: unknown, output: unknown): Session {\n\t\treturn new Session(io, logger, input as string, output as string);\n\t}\n\n\tpublic setDisplay(display: boolean): this {\n\t\tthis._display = display;\n\t\treturn this;\n\t}\n\n\tpublic async transform(...transforms: Transform[]): Promise<void> {\n\t\tconst logger = this._logger;\n\t\tconst document = this._input\n\t\t\t? (await this._io.read(this._input)).setLogger(this._logger)\n\t\t\t: new Document().setLogger(this._logger);\n\n\t\t// Warn and remove lossy compression, to avoid increasing loss on round trip.\n\t\tfor (const extensionName of ['KHR_draco_mesh_compression', 'EXT_meshopt_compression']) {\n\t\t\tconst extension = document\n\t\t\t\t.getRoot()\n\t\t\t\t.listExtensionsUsed()\n\t\t\t\t.find((extension) => extension.extensionName === extensionName);\n\t\t\tif (extension) {\n\t\t\t\textension.dispose();\n\t\t\t\tthis._logger.warn(`Decoded ${extensionName}. Further compression will be lossy.`);\n\t\t\t}\n\t\t}\n\n\t\tif (this._display) {\n\t\t\tconst tasks = [] as ListrTask[];\n\t\t\tfor (const transform of transforms) {\n\t\t\t\ttasks.push({\n\t\t\t\t\ttitle: transform.name,\n\t\t\t\t\ttask: async (ctx, task) => {\n\t\t\t\t\t\tlet time = performance.now();\n\t\t\t\t\t\tawait document.transform(transform);\n\t\t\t\t\t\ttime = Math.round(performance.now() - time);\n\t\t\t\t\t\ttask.title = task.title.padEnd(20) + dim(` ${formatLong(time)}ms`);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst prevLevel = logger.getVerbosity();\n\t\t\tif (prevLevel === Verbosity.INFO) logger.setVerbosity(Verbosity.WARN);\n\n\t\t\t// Simple renderer shows warnings and errors. Disable signal listeners so Ctrl+C works.\n\t\t\tawait new Listr(tasks, { renderer: 'simple', registerSignalListeners: false }).run();\n\t\t\tconsole.log('');\n\n\t\t\tlogger.setVerbosity(prevLevel);\n\t\t} else {\n\t\t\tawait document.transform(...transforms);\n\t\t}\n\n\t\tawait document.transform(updateMetadata);\n\n\t\tif (this._outputFormat === Format.GLB) {\n\t\t\tawait document.transform(unpartition());\n\t\t}\n\n\t\tawait this._io.write(this._output, document);\n\n\t\tconst { lastReadBytes, lastWriteBytes } = this._io;\n\t\tif (!this._input) {\n\t\t\tconst output = FileUtils.basename(this._output) + '.' + FileUtils.extension(this._output);\n\t\t\tthis._logger.info(`${output} (${formatBytes(lastWriteBytes)})`);\n\t\t} else {\n\t\t\tconst input = FileUtils.basename(this._input) + '.' + FileUtils.extension(this._input);\n\t\t\tconst output = FileUtils.basename(this._output) + '.' + FileUtils.extension(this._output);\n\t\t\tthis._logger.info(\n\t\t\t\t`${input} (${formatBytes(lastReadBytes)})` + ` → ${output} (${formatBytes(lastWriteBytes)})`,\n\t\t\t);\n\t\t}\n\t}\n}\n\nfunction updateMetadata(document: Document): void {\n\tconst root = document.getRoot();\n\tconst xmpExtension = root\n\t\t.listExtensionsUsed()\n\t\t.find((ext) => ext.extensionName === 'KHR_xmp_json_ld') as KHRXMP | null;\n\n\t// Do not add KHR_xmp_json_ld to assets that don't already use it.\n\tif (!xmpExtension) return;\n\n\tconst rootPacket = root.getExtension<Packet>('KHR_xmp_json_ld') || xmpExtension.createPacket();\n\n\t// xmp:MetadataDate should be the same as, or more recent than, xmp:ModifyDate.\n\t// https://github.com/adobe/xmp-docs/blob/master/XMPNamespaces/xmp.md\n\tconst date = new Date().toISOString().substring(0, 10);\n\trootPacket\n\t\t.setContext({ ...rootPacket.getContext(), xmp: XMPContext.xmp })\n\t\t.setProperty('xmp:ModifyDate', date)\n\t\t.setProperty('xmp:MetadataDate', date);\n}\n","import fs from 'node:fs/promises';\nimport path from 'node:path';\nimport type { ILogger } from '@gltf-transform/core';\nimport { formatHeader, formatTable, TableFormat } from './util.js';\n\nexport interface ValidateOptions {\n\tlimit: number;\n\tignore: string[];\n\tformat: TableFormat;\n}\n\ninterface ValidatorReport {\n\tissues: { messages: ValidatorMessage[] };\n}\n\ninterface ValidatorMessage {\n\tseverity: number;\n}\n\nexport async function validate(input: string, options: ValidateOptions, logger: ILogger): Promise<void> {\n\tconst [buffer, validator] = await Promise.all([fs.readFile(input), import('gltf-validator')]);\n\treturn validator\n\t\t.validateBytes(new Uint8Array(buffer), {\n\t\t\tmaxIssues: options.limit,\n\t\t\tignoredIssues: options.ignore,\n\t\t\texternalResourceFunction: (uri: string) => {\n\t\t\t\turi = path.resolve(path.dirname(input), decodeURIComponent(uri));\n\t\t\t\treturn fs.readFile(uri).catch((err) => {\n\t\t\t\t\tlogger.warn(`Unable to validate \"${uri}\": ${err.toString()}.`);\n\t\t\t\t\tthrow err.toString();\n\t\t\t\t});\n\t\t\t},\n\t\t})\n\t\t.then(async (report: ValidatorReport) => {\n\t\t\tawait printIssueSection('error', 0, report, logger, options.format);\n\t\t\tawait printIssueSection('warning', 1, report, logger, options.format);\n\t\t\tawait printIssueSection('info', 2, report, logger, options.format);\n\t\t\tawait printIssueSection('hint', 3, report, logger, options.format);\n\t\t});\n}\n\nasync function printIssueSection(\n\theader: string,\n\tseverity: number,\n\treport: ValidatorReport,\n\tlogger: ILogger,\n\tformat: TableFormat,\n): Promise<void> {\n\tconsole.log(formatHeader(header));\n\tconst messages = report.issues.messages.filter((msg) => msg.severity === severity);\n\tif (messages.length) {\n\t\tconsole.log(\n\t\t\t(await formatTable(\n\t\t\t\tformat,\n\t\t\t\t['code', 'message', 'severity', 'pointer'],\n\t\t\t\tmessages.map((m) => Object.values(m)),\n\t\t\t)) + '\\n\\n',\n\t\t);\n\t} else {\n\t\tlogger.info(`No ${header}s found.`);\n\t}\n\tconsole.log('\\n');\n}\n","import type { Extension, NodeIO } from '@gltf-transform/core';\nimport { ALL_EXTENSIONS } from '@gltf-transform/extensions';\nimport { resolve } from 'path';\nimport draco3d from 'draco3dgltf';\nimport { MeshoptEncoder, MeshoptDecoder } from 'meshoptimizer';\nimport type { Session } from './session.js';\nimport { program } from './program.js';\n\ninterface Config {\n\textensions: (typeof Extension)[];\n\tdependencies: Record<string, unknown>;\n\tonProgramReady?: (params: { program: typeof program; io: NodeIO; Session: typeof Session }) => Promise<void>;\n}\n\nexport type CustomConfig = Partial<Config>;\n\ntype ConfigModule = { default: CustomConfig };\n\nlet customConfigPromise: Promise<ConfigModule> | null = null;\n\nexport async function defineConfig(\n\tconfigProvider: CustomConfig | (() => Promise<CustomConfig>),\n): Promise<CustomConfig> {\n\tif (typeof configProvider === 'function') {\n\t\tconfigProvider = await configProvider();\n\t}\n\treturn configProvider;\n}\n\nexport function createDefaultConfig(): Promise<Config> {\n\treturn Promise.all([\n\t\tdraco3d.createDecoderModule(),\n\t\tdraco3d.createEncoderModule(),\n\t\tMeshoptDecoder.ready,\n\t\tMeshoptEncoder.ready,\n\t]).then(([decoder, encoder, _]) => {\n\t\treturn {\n\t\t\textensions: ALL_EXTENSIONS,\n\t\t\tdependencies: {\n\t\t\t\t'draco3d.decoder': decoder,\n\t\t\t\t'draco3d.encoder': encoder,\n\t\t\t\t'meshopt.decoder': MeshoptDecoder,\n\t\t\t\t'meshopt.encoder': MeshoptEncoder,\n\t\t\t},\n\t\t\tonProgramReady: undefined,\n\t\t};\n\t});\n}\n\nexport function loadConfig(path: string) {\n\tpath = resolve(process.cwd(), path);\n\tpath = `file:${path}`; // Required on Windows.\n\tcustomConfigPromise = import(path).then(validateConfig) as Promise<ConfigModule>;\n}\n\nexport function validateConfig(config: CustomConfig): CustomConfig {\n\tfor (const extension of config.extensions || []) {\n\t\tif (!extension.EXTENSION_NAME) {\n\t\t\tthrow new Error('Invalid extension in config.extensions.');\n\t\t}\n\t}\n\treturn config;\n}\n\nexport async function getConfig(): Promise<Config> {\n\tconst config = await createDefaultConfig();\n\tif (customConfigPromise) {\n\t\tconst { default: customConfig } = await customConfigPromise;\n\t\tObject.assign(config, customConfig);\n\t}\n\treturn config;\n}\n","import { program as _program, Command, Logger as WinstonLogger } from '@donmccurdy/caporal';\nimport { ILogger, Verbosity } from '@gltf-transform/core';\n\nconst PAD_EMOJI = new Set(['🫖', '🖼', '⏯️']);\n\n/**********************************************************************************************\n * Program.\n */\n\nexport interface IProgram {\n\tcommand: (name: string, desc: string) => ICommand;\n\toption: (name: string, desc: string, options: IProgramOptions) => this;\n\tsection: (name: string, icon: string) => this;\n}\n\ninterface IExecOptions {\n\tsilent?: boolean;\n}\n\ninterface IInternalProgram extends IProgram {\n\tversion: (version: string) => this;\n\tdescription: (desc: string) => this;\n\tdisableGlobalOption: (name: string) => this;\n\trun: () => this;\n\texec: (args: unknown[], options?: IExecOptions) => Promise<void>;\n}\n\nexport interface IProgramOptions<T = unknown> {\n\tdefault?: T;\n\tvalidator?: ValidatorFn | T[];\n\taction?: IActionFn;\n}\n\nexport type IActionFn = (params: {\n\targs: Record<string, unknown>;\n\toptions: Record<string, unknown>;\n\tlogger: Logger;\n}) => void;\n\nexport interface IHelpOptions {\n\tsectionName?: string;\n}\n\nclass ProgramImpl implements IInternalProgram {\n\tversion(version: string) {\n\t\t_program.version(version);\n\t\treturn this;\n\t}\n\tdescription(desc: string) {\n\t\t_program.description(desc);\n\t\treturn this;\n\t}\n\thelp(help: string, options?: IHelpOptions) {\n\t\t_program.help(help, options);\n\t\treturn this;\n\t}\n\tsection(_name: string, _icon: string) {\n\t\tconst icon = _icon + (PAD_EMOJI.has(_icon) ? ' ' : '');\n\t\tconst name = _name.toUpperCase();\n\t\tconst line = ''.padEnd(50 - name.length - 1, '─');\n\t\t_program.command('', `\\n\\n${icon} ${name} ${line}`);\n\t\treturn this;\n\t}\n\tcommand(name: string, desc: string): ICommand {\n\t\treturn new CommandImpl(_program, name, desc);\n\t}\n\toption<T>(name: string, desc: string, options: IProgramOptions<T>) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t_program.option(name, desc, { global: true, ...options } as any);\n\t\treturn this;\n\t}\n\tdisableGlobalOption(name: string) {\n\t\t_program.disableGlobalOption(name);\n\t\treturn this;\n\t}\n\trun() {\n\t\t_program.run();\n\t\treturn this;\n\t}\n\tasync exec(args: unknown[], options?: IExecOptions) {\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\tawait _program.exec(args as any, options as any);\n\t}\n}\n\n/**********************************************************************************************\n * Command.\n */\n\nexport interface ICommand {\n\thelp: (text: string) => this;\n\targument: (name: string, desc: string) => this;\n\toption: (name: string, desc: string, options?: ICommandOptions) => this;\n\taction: (fn: IActionFn) => this;\n\talias: (name: string) => this;\n}\n\nexport interface ICommandOptions {}\n\nclass CommandImpl implements ICommand {\n\t_ctx: Command;\n\tconstructor(program: typeof _program, name: string, desc: string) {\n\t\tthis._ctx = program.command(name, desc);\n\t}\n\thelp(text: string) {\n\t\tthis._ctx.help(text);\n\t\treturn this;\n\t}\n\targument(name: string, desc: string) {\n\t\tthis._ctx.argument(name, desc);\n\t\treturn this;\n\t}\n\toption(name: string, desc: string, options?: ICommandOptions) {\n\t\tthis._ctx.option(name, desc, options);\n\t\treturn this;\n\t}\n\taction(fn: IActionFn) {\n\t\tthis._ctx.action(async (args) => {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\tconst logger = new Logger(args.logger as any);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\treturn fn({ ...args, logger } as any);\n\t\t});\n\t\treturn this;\n\t}\n\talias(name: string) {\n\t\tthis._ctx.alias(name);\n\t\treturn this;\n\t}\n}\n\nexport const program = new ProgramImpl();\n\n/**********************************************************************************************\n * Validator.\n */\n\ntype ValidatorFn = unknown;\ntype ValidatorType = 'NUMBER' | 'ARRAY' | 'BOOLEAN' | 'STRING';\n\nexport const Validator: Record<ValidatorType, ValidatorFn> = {\n\tNUMBER: _program.NUMBER,\n\tARRAY: _program.ARRAY,\n\tBOOLEAN: _program.BOOLEAN,\n\tSTRING: _program.STRING,\n};\n\n/**********************************************************************************************\n * Logger.\n */\n\nexport class Logger implements ILogger {\n\t_logger: WinstonLogger;\n\t_verbosity: Verbosity;\n\tconstructor(logger: WinstonLogger) {\n\t\tthis._logger = logger;\n\n\t\tswitch (logger.level) {\n\t\t\tcase 'info':\n\t\t\t\tthis._verbosity = Verbosity.INFO;\n\t\t\t\tbreak;\n\t\t\tcase 'warn':\n\t\t\t\tthis._verbosity = Verbosity.WARN;\n\t\t\t\tbreak;\n\t\t\tcase 'error':\n\t\t\t\tthis._verbosity = Verbosity.ERROR;\n\t\t\t\tbreak;\n\t\t\tcase 'debug':\n\t\t\tdefault:\n\t\t\t\tthis._verbosity = Verbosity.DEBUG;\n\t\t}\n\t}\n\tgetVerbosity() {\n\t\treturn this._verbosity;\n\t}\n\tsetVerbosity(verbosity: Verbosity) {\n\t\tswitch (verbosity) {\n\t\t\tcase Verbosity.INFO:\n\t\t\t\tthis._logger.level = 'info';\n\t\t\t\tbreak;\n\t\t\tcase Verbosity.WARN:\n\t\t\t\tthis._logger.level = 'warn';\n\t\t\t\tbreak;\n\t\t\tcase Verbosity.ERROR:\n\t\t\t\tthis._logger.level = 'error';\n\t\t\t\tbreak;\n\t\t\tcase Verbosity.DEBUG:\n\t\t\t\tthis._logger.level = 'debug';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unexpected verbosity, \"${verbosity}\".`);\n\t\t}\n\t\tthis._verbosity = verbosity;\n\t}\n\tdebug(msg: string) {\n\t\tthis._logger.debug(msg);\n\t}\n\tinfo(msg: string) {\n\t\tthis._logger.info(msg);\n\t}\n\twarn(msg: string) {\n\t\tthis._logger.warn(msg);\n\t}\n\terror(msg: string) {\n\t\tthis._logger.error(msg);\n\t}\n}\n","import { URL } from 'url';\nimport { promises as fs, readFileSync } from 'fs';\nimport micromatch from 'micromatch';\nimport { gzip } from 'node-gzip';\nimport fetch from 'node-fetch';\nimport mikktspace from 'mikktspace';\nimport { MeshoptEncoder, MeshoptSimplifier } from 'meshoptimizer';\nimport { ready as resampleReady, resample as resampleWASM } from 'keyframe-resample';\nimport { Logger, NodeIO, PropertyType, VertexLayout, vec2, Transform } from '@gltf-transform/core';\nimport {\n\tCenterOptions,\n\tInstanceOptions,\n\tPartitionOptions,\n\tPruneOptions,\n\tQUANTIZE_DEFAULTS,\n\tResampleOptions,\n\tSequenceOptions,\n\tTEXTURE_RESIZE_DEFAULTS,\n\tTextureResizeFilter,\n\tUnweldOptions,\n\tWeldOptions,\n\tcenter,\n\tdedup,\n\tinstance,\n\tmetalRough,\n\tpartition,\n\tprune,\n\tquantize,\n\tresample,\n\tsequence,\n\ttangents,\n\tunweld,\n\tweld,\n\treorder,\n\tdequantize,\n\tunlit,\n\tmeshopt,\n\tDRACO_DEFAULTS,\n\tdraco,\n\tDracoOptions,\n\tsimplify,\n\tSIMPLIFY_DEFAULTS,\n\tWELD_DEFAULTS,\n\ttextureCompress,\n\tFlattenOptions,\n\tflatten,\n\tJOIN_DEFAULTS,\n\tjoin,\n\tJoinOptions,\n\tsparse,\n\tSparseOptions,\n\tpalette,\n\tPaletteOptions,\n\tPALETTE_DEFAULTS,\n\tMESHOPT_DEFAULTS,\n\tTEXTURE_COMPRESS_SUPPORTED_FORMATS,\n} from '@gltf-transform/functions';\nimport { inspect } from './inspect.js';\nimport {\n\tETC1S_DEFAULTS,\n\tFilter,\n\tMode,\n\tUASTC_DEFAULTS,\n\tktxfix,\n\tmerge,\n\ttoktx,\n\tXMPOptions,\n\txmp,\n} from './transforms/index.js';\nimport { formatBytes, MICROMATCH_OPTIONS, underline, TableFormat, dim, regexFromArray } from './util.js';\nimport { Session } from './session.js';\nimport { ValidateOptions, validate } from './validate.js';\nimport { getConfig, loadConfig } from './config.js';\nimport { Validator, program } from './program.js';\n\nlet io: NodeIO;\n\nconst programReady = new Promise<void>((resolve) => {\n\t// Manually detect and handle --config, before program actually runs.\n\tif (process.argv.includes('--config')) {\n\t\tloadConfig(process.argv[process.argv.indexOf('--config') + 1]);\n\t}\n\treturn getConfig().then(async (config) => {\n\t\tio = new NodeIO(fetch).registerExtensions(config.extensions).registerDependencies(config.dependencies);\n\t\tif (config.onProgramReady) {\n\t\t\tprogram.section('User', '👤');\n\t\t\tawait config.onProgramReady({ program, io, Session });\n\t\t}\n\t\tresolve();\n\t});\n});\n\nconst INPUT_DESC = 'Path to read glTF 2.0 (.glb, .gltf) model';\nconst OUTPUT_DESC = 'Path to write output';\n\nconst PACKAGE = JSON.parse(readFileSync(new URL('../package.json', import.meta.url), 'utf-8'));\n\nprogram.version(PACKAGE.version).description('Command-line interface (CLI) for the glTF Transform SDK.');\n\nif (process.argv && !process.argv.includes('--no-editorial')) {\n\tprogram\n\t\t.help(\n\t\t\t`\nTo run the most common optimizations in one easy step, use the 'optimize' command:\n\n▸ gltf-transform optimize <input> <output> --compress draco --texture-compress webp\n\nDefaults in the 'optimize' command may not be ideal for all scenes. Some of its\nfeatures can be configured (${dim(`optimize --help`)}), or more advanced users may wish\nto inspect their scenes then pick and choose optimizations.\n\n▸ gltf-transform inspect <input>\n\nThe report printed by the 'inspect' command should identify performance issues,\nand whether the scene is generally geometry-heavy, texture-heavy, has too many\ndraw calls, etc. Apply individual commands below to deal with any of these\nissues as needed.\n`.trim(),\n\t\t)\n\t\t.help(\n\t\t\t`\n${underline('Using glTF Transform for a personal project?')} That's great! Sponsorship is\nneither expected nor required. Feel free to share screenshots if you've\nmade something you're excited about — I enjoy seeing those!\n\n${underline('Using glTF Transform in for-profit work?')} That's wonderful! Your support is\nimportant to keep glTF Transform maintained, independent, and open source under\nMIT License. Please consider a subscription or GitHub sponsorship.\n\nLearn more in the glTF Transform Pro FAQs (https://gltf-transform.dev/pro).\n`.trim(),\n\t\t\t{ sectionName: 'COMMERCIAL USE' },\n\t\t);\n}\n\nprogram.section('Inspect', '🔎');\n\n// INSPECT\nprogram\n\t.command('inspect', 'Inspect contents of the model')\n\t.help(\n\t\t`\nInspect the contents of the model, printing a table with properties and\nstatistics for scenes, meshes, materials, textures, and animations contained\nby the file. This data is useful for understanding how much of a file's size\nis comprised of geometry vs. textures, which extensions are needed when loading\nthe file, and which material properties are being used.\n\nUse --format=csv or --format=md for alternative display formats.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.option('--format <format>', 'Table output format', {\n\t\tvalidator: [TableFormat.PRETTY, TableFormat.CSV, TableFormat.MD],\n\t\tdefault: TableFormat.PRETTY,\n\t})\n\t.action(async ({ args, options, logger }) => {\n\t\tio.setLogger(logger as unknown as Logger);\n\t\tawait inspect(\n\t\t\tawait io.readAsJSON(args.input as string),\n\t\t\tio,\n\t\t\tlogger as unknown as Logger,\n\t\t\toptions.format as TableFormat,\n\t\t);\n\t});\n\n// VALIDATE\nprogram\n\t.command('validate', 'Validate model against the glTF spec')\n\t.help(\n\t\t`\nValidate the model with official glTF validator. The validator detects whether\na file conforms correctly to the glTF specification, and is useful for\ndebugging issues with a model. Validation errors typically suggest a problem\nin the authoring process, and can be reported as bugs on the software used to\nexport the file. Certain lower-priority issues are not technically invalid, but\nmay indicate an unintended situation in the file, like unused data not attached\nto any particular scene.\n\nFor more details about the official validation suite used here, see:\nhttps://github.com/KhronosGroup/glTF-Validator\n\nExample:\n\n  ▸ gltf-transform validate input.glb --ignore ACCESSOR_WEIGHTS_NON_NORMALIZED\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.option('--limit <limit>', 'Limit number of issues to display', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: 1e7,\n\t})\n\t.option('--ignore <CODE>,<CODE>,...', 'Issue codes to be ignored', {\n\t\tvalidator: Validator.ARRAY,\n\t\tdefault: [],\n\t})\n\t.option('--format <format>', 'Table output format', {\n\t\tvalidator: [TableFormat.PRETTY, TableFormat.CSV, TableFormat.MD],\n\t\tdefault: TableFormat.PRETTY,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\treturn validate(args.input as string, options as unknown as ValidateOptions, logger as unknown as Logger);\n\t});\n\nprogram.section('Package', '📦');\n\n// COPY\nprogram\n\t.command('copy', 'Copy model with minimal changes')\n\t.alias('cp')\n\t.help(\n\t\t`\nCopy the model from <input> to <output> with minimal changes. Unlike filesystem\n\\`cp\\`, this command does parse the file into glTF Transform's internal\nrepresentation before serializing it to disk again. No other intentional\nchanges are made, so copying a model can be a useful first step to confirm that\nglTF Transform is reading and writing the model correctly when debugging issues\nin a larger script doing more complex processing of the file. Copying may also\nbe used to ensure consistent data layout across glTF files from different\nexporters, e.g. if your engine always requires interleaved vertex attributes.\n\nWhile vertex data remains byte-for-byte the same before and after copying, and\nscene, node, material, and other properties are also preserved losslessly,\ncertain aspects of data layout may change slightly with this process:\n\n- Vertex attributes within a mesh are interleaved.\n- Accessors are organized into buffer views according to usage.\n- Draco compression is removed to avoid a lossy decompress/compress round trip.\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, logger }) => Session.create(io, logger, args.input, args.output).transform());\n\n// OPTIMIZE\nprogram\n\t.command('optimize', 'Optimize model by all available methods')\n\t.help(\n\t\t`\nOptimize the model by all available methods. Combines many features of the\nglTF Transform CLI into a single command for convenience and faster results.\nFor more control over the optimization process, consider running individual\ncommands or using the scripting API.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--instance <bool>', 'Use GPU instancing with shared mesh references.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--instance-min <min>', 'Number of instances required for instancing.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: 5,\n\t})\n\t.option('--palette <bool>', 'Creates palette textures and merges materials.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option(\n\t\t'--palette-min <min>',\n\t\t'Minimum number of blocks in the palette texture. If fewer unique ' +\n\t\t\t'material values are found, no palettes will be generated.',\n\t\t{\n\t\t\tvalidator: Validator.NUMBER,\n\t\t\tdefault: 5,\n\t\t},\n\t)\n\t.option('--simplify <bool>', 'Simplify mesh geometry with meshoptimizer.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--simplify-error <error>', 'Simplification error tolerance, as a fraction of mesh extent.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: SIMPLIFY_DEFAULTS.error,\n\t})\n\t.option(\n\t\t'--compress <method>',\n\t\t'Floating point compression method. Draco compresses geometry; Meshopt ' +\n\t\t\t'and quantization compress geometry and animation.',\n\t\t{\n\t\t\tvalidator: ['draco', 'meshopt', 'quantize', false],\n\t\t\tdefault: 'draco',\n\t\t},\n\t)\n\t.option(\n\t\t'--texture-compress <format>',\n\t\t'Texture compression format. KTX2 optimizes VRAM usage and performance; ' +\n\t\t\t'AVIF and WebP optimize transmission size. Auto recompresses in original format.',\n\t\t{\n\t\t\tvalidator: ['ktx2', 'webp', 'avif', 'auto', false],\n\t\t\tdefault: 'auto',\n\t\t},\n\t)\n\t.option('--texture-size <size>', 'Maximum texture dimensions, in pixels.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: 2048,\n\t})\n\t.option('--flatten <bool>', 'Flatten scene graph.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--join <bool>', 'Join meshes and reduce draw calls. Requires `--flatten`.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--weld <bool>', 'Index geometry and merge similar vertices. Often required when simplifying geometry.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.action(async ({ args, options, logger }) => {\n\t\tconst opts = options as {\n\t\t\tinstance: boolean;\n\t\t\tinstanceMin: number;\n\t\t\tpalette: boolean;\n\t\t\tpaletteMin: number;\n\t\t\tsimplify: boolean;\n\t\t\tsimplifyError: number;\n\t\t\tcompress: 'draco' | 'meshopt' | 'quantize' | false;\n\t\t\ttextureCompress: 'ktx2' | 'webp' | 'webp' | 'auto' | false;\n\t\t\ttextureSize: number;\n\t\t\tflatten: boolean;\n\t\t\tjoin: boolean;\n\t\t\tweld: boolean;\n\t\t};\n\n\t\t// Baseline transforms.\n\t\tconst transforms: Transform[] = [dedup()];\n\n\t\tif (opts.instance) transforms.push(instance({ min: opts.instanceMin }));\n\t\tif (opts.palette) transforms.push(palette({ min: opts.paletteMin }));\n\t\tif (opts.flatten) transforms.push(flatten());\n\t\tif (opts.join) transforms.push(join());\n\n\t\tif (opts.weld) {\n\t\t\ttransforms.push(\n\t\t\t\tweld({\n\t\t\t\t\ttolerance: opts.simplify ? opts.simplifyError / 2 : WELD_DEFAULTS.tolerance,\n\t\t\t\t\ttoleranceNormal: opts.simplify ? 0.5 : WELD_DEFAULTS.toleranceNormal,\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tif (opts.simplify) {\n\t\t\ttransforms.push(simplify({ simplifier: MeshoptSimplifier, error: opts.simplifyError }));\n\t\t}\n\n\t\ttransforms.push(\n\t\t\tresample({ ready: resampleReady, resample: resampleWASM }),\n\t\t\tprune({\n\t\t\t\tkeepAttributes: false,\n\t\t\t\tkeepIndices: false,\n\t\t\t\tkeepLeaves: false,\n\t\t\t\tkeepSolidTextures: false,\n\t\t\t}),\n\t\t\tsparse(),\n\t\t);\n\n\t\t// Texture compression.\n\t\tif (opts.textureCompress === 'ktx2') {\n\t\t\tconst slotsUASTC = micromatch.makeRe(\n\t\t\t\t'{normalTexture,occlusionTexture,metallicRoughnessTexture}',\n\t\t\t\tMICROMATCH_OPTIONS,\n\t\t\t);\n\t\t\ttransforms.push(\n\t\t\t\ttoktx({ mode: Mode.UASTC, slots: slotsUASTC, level: 4, rdo: 4, zstd: 18 }),\n\t\t\t\ttoktx({ mode: Mode.ETC1S, quality: 255 }),\n\t\t\t);\n\t\t} else if (opts.textureCompress !== false) {\n\t\t\tconst { default: encoder } = await import('sharp');\n\t\t\ttransforms.push(\n\t\t\t\ttextureCompress({\n\t\t\t\t\tencoder,\n\t\t\t\t\ttargetFormat: opts.textureCompress === 'auto' ? undefined : opts.textureCompress,\n\t\t\t\t\tresize: [opts.textureSize, opts.textureSize],\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t// Mesh compression last. Doesn't matter here, but in one-off CLI\n\t\t// commands we want to avoid recompressing mesh data.\n\t\tif (opts.compress === 'draco') {\n\t\t\ttransforms.push(draco());\n\t\t} else if (opts.compress === 'meshopt') {\n\t\t\ttransforms.push(meshopt({ encoder: MeshoptEncoder }));\n\t\t} else if (opts.compress === 'quantize') {\n\t\t\ttransforms.push(quantize());\n\t\t}\n\n\t\treturn Session.create(io, logger, args.input, args.output)\n\t\t\t.setDisplay(true)\n\t\t\t.transform(...transforms);\n\t});\n\n// MERGE\nprogram\n\t.command('merge', 'Merge two or more models into one')\n\t.help(\n\t\t`\nMerge two or more models into one, each in a separate Scene. Optionally, the\nbinary data for each model may be kept in a separate buffer with the\n--partition flag.\n\nExample:\n\n  ▸ gltf-transform merge a.glb b.glb c.glb output.glb\n\t`.trim(),\n\t)\n\t.argument('<path...>', `${INPUT_DESC}(s). Final path is used to write output.`)\n\t.option('--partition', 'Whether to keep separate buffers for each input file. Invalid for GLB output.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.option('--merge-scenes', 'Whether to merge scenes, or keep one scene per input file.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst paths = typeof args.path === 'string' ? args.path.split(',') : (args.path as string[]);\n\t\tconst output = paths.pop();\n\t\treturn Session.create(io, logger, '', output).transform(merge({ io, paths, ...options }));\n\t});\n\n// PARTITION\nprogram\n\t.command('partition', 'Partition binary data into separate .bin files')\n\t.help(\n\t\t`\nPartition binary data for meshes or animations into separate .bin files. In\nengines that support lazy-loading resources within glTF files, this allows\nrestructuring the data to minimize initial load time, fetching additional\nresources as needed. Partitioning is supported only for .gltf, not .glb, files.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--animations', 'Partition each animation into a separate .bin file', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.option('--meshes', 'Partition each mesh into a separate .bin file', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(partition(options as PartitionOptions)),\n\t);\n\n// DEDUP\nprogram\n\t.command('dedup', 'Deduplicate accessors and textures')\n\t.help(\n\t\t`\nDeduplicate accessors, textures, materials, meshes, and skins. Some exporters or\npipeline processing may lead to multiple resources within a file containing\nredundant copies of the same information. This functions scans for these cases\nand merges the duplicates where possible, reducing file size. The process may\nbe very slow on large files with many accessors.\n\nDeduplication early in a pipeline may also help other optimizations, like\ncompression and instancing, to be more effective.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--accessors <accessors>', 'Remove duplicate accessors', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--materials <materials>', 'Remove duplicate materials', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--meshes <meshes>', 'Remove duplicate meshes', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--skins <skins>', 'Remove duplicate skins', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.option('--textures <textures>', 'Remove duplicate textures', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst propertyTypes: string[] = [];\n\t\tif (options.accessors) propertyTypes.push(PropertyType.ACCESSOR);\n\t\tif (options.materials) propertyTypes.push(PropertyType.MATERIAL);\n\t\tif (options.meshes) propertyTypes.push(PropertyType.MESH);\n\t\tif (options.skins) propertyTypes.push(PropertyType.SKIN);\n\t\tif (options.textures) propertyTypes.push(PropertyType.TEXTURE);\n\t\treturn Session.create(io, logger, args.input, args.output).transform(dedup({ propertyTypes }));\n\t});\n\n// PRUNE\nprogram\n\t.command('prune', 'Remove unreferenced properties from the file')\n\t.help(\n\t\t`\nRemoves properties from the file if they are not referenced by a Scene. Helpful\nwhen cleaning up after complex workflows or a faulty exporter. This function\nmay (conservatively) fail to identify some unused extension properties, such as\nlights, but it will not remove anything that is still in use, even if used by\nan extension. Animations are considered unused if they do not target any nodes\nthat are children of a scene.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--keep-attributes <keepAttributes>', 'Whether to keep unused vertex attributes', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true, // TODO(v4): Default false.\n\t})\n\t.option('--keep-indices <keepIndices>', 'Whether to keep unused mesh indices', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true, // TODO(v4): Default false.\n\t})\n\t.option('--keep-leaves <keepLeaves>', 'Whether to keep empty leaf nodes', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.option(\n\t\t'--keep-solid-textures <keepSolidTextures>',\n\t\t'Whether to keep solid (single-color) textures, or convert to material factors',\n\t\t{\n\t\t\tvalidator: Validator.BOOLEAN,\n\t\t\tdefault: true, // TODO(v4): Default false.\n\t\t},\n\t)\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(prune(options as unknown as PruneOptions)),\n\t);\n\n// GZIP\nprogram\n\t.command('gzip', 'Compress model with lossless gzip')\n\t.help(\n\t\t`\nCompress the model with gzip. Gzip is a general-purpose file compression\ntechnique, not specific to glTF models. On the web, decompression is\nhandled automatically by the web browser, without any intervention from the\nclient application.\n\nWhen the model contains resources that are already effectively compressed, like\nJPEG textures or Draco geometry, gzip is unlikely to add much further benefit\nand can be skipped. Other compression strategies, like Meshopt and quantization,\nwork best when combined with gzip.\n`,\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.action(async ({ args, logger }) => {\n\t\tconst inBuffer = await fs.readFile(args.input as string);\n\t\tconst outBuffer = await gzip(inBuffer);\n\t\tconst fileName = args.input + '.gz';\n\t\tconst inSize = formatBytes(inBuffer.byteLength);\n\t\tconst outSize = formatBytes(outBuffer.byteLength);\n\t\tawait fs.writeFile(fileName, outBuffer);\n\t\tlogger.info(`Created ${fileName} (${inSize} → ${outSize})`);\n\t});\n\n// XMP\nprogram\n\t.command('xmp', 'Add or modify XMP metadata')\n\t.help(\n\t\t`\nXMP metadata provides standardized fields describing the content, provenance, usage restrictions,\nor other attributes of a 3D model. Such metadata does not generally affect the parsing or runtime\nbehavior of the content — for that, use custom extensions, custom vertex attributes, or extras.\n\nThe easiest (and default) mode of the CLI 'xmp' command provides interactive prompts, walking\nthrough a series of questions and then constructing appropriate JSONLD output. These interactive\nprompts do not include all possible XMP namespaces and fields, but should cover most common cases.\n\nFor more advanced cases, provide an external .jsonld or .json file specified by the --packet\nflag, or use the scripting API to manually input JSONLD fields.\n\nTo remove XMP metadata and the KHR_xmp_json_ld extension, use the --reset flag.\n\n${underline('Documentation')}\n- https://gltf-transform.dev/classes/extensions.xmp.html\n`,\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--packet <path>', 'Path to XMP packet (.jsonld or .json)')\n\t.option('--reset', 'Reset metadata and remove XMP extension', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.action(async ({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(xmp({ ...options } as XMPOptions)),\n\t);\n\nprogram.section('Scene', '🌍');\n\n// CENTER\nprogram\n\t.command('center', 'Center the scene at the origin, or above/below it')\n\t.help(\n\t\t`\nCenter the scene at the origin, or above/below it. When loading a model into\na larger scene, or into an augmented reality context, it's often best to ensure\nthe model's pivot is centered beneath the object. For objects meant to be\nattached a surface, like a ceiling fan, the pivot may be located above instead.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pivot <pivot>', 'Method used to determine the scene pivot', {\n\t\tvalidator: ['center', 'above', 'below'],\n\t\tdefault: 'center',\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(center({ ...options } as CenterOptions)),\n\t);\n\n// INSTANCE\nprogram\n\t.command('instance', 'Create GPU instances from shared mesh references')\n\t.help(\n\t\t`\nFor meshes reused by more than one node in a scene, this command creates an\nEXT_mesh_gpu_instancing extension to aid with GPU instancing. In engines that\nsupport the extension, this may allow GPU instancing to be used, reducing draw\ncalls and improving framerate.\n\nEngines may use GPU instancing with or without the presence of this extension,\nand are strongly encouraged to do so. However, particularly when loading a\nmodel at runtime, the extension provides useful context allowing the engine to\nuse this technique efficiently.\n\nInstanced meshes cannot be animated, and must share the same materials. For\nfurther details, see:\n\nhttps://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(instance({ ...options } as InstanceOptions)),\n\t);\n\n// FLATTEN\nprogram\n\t.command('flatten', 'Flatten scene graph')\n\t.help(\n\t\t`\nFlattens the scene graph, leaving Nodes with Meshes, Cameras, and other\nattachments as direct children of the Scene. Skeletons and their\ndescendants are left in their original Node structure.\n\nAnimation targeting a Node or its parents will prevent that Node from being\nmoved.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(flatten({ ...options } as FlattenOptions)),\n\t);\n\n// JOIN\nprogram\n\t.command('join', 'Join meshes and reduce draw calls')\n\t.help(\n\t\t`\nJoins compatible Primitives and reduces draw calls. Primitives are eligible for\njoining if they are members of the same Mesh or, optionally, attached to sibling\nNodes in the scene hierarchy. Implicitly runs \\`dedup\\` and \\`flatten\\` commands\nfirst, to maximize the number of Primitives that can be joined.\n\nNOTE: In a Scene that heavily reuses the same Mesh data, joining may increase\nvertex count. Consider alternatives, like \\`instance\\` with\nEXT_mesh_gpu_instancing.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--keepMeshes <bool>', 'Prevents joining distinct Meshes and Nodes.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: JOIN_DEFAULTS.keepMeshes,\n\t})\n\t.option('--keepNamed <bool>', 'Prevents joining named Meshes and Nodes.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: JOIN_DEFAULTS.keepNamed,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(\n\t\t\tdedup({ propertyTypes: [PropertyType.MATERIAL] }),\n\t\t\tflatten(),\n\t\t\tjoin({ ...options } as unknown as JoinOptions),\n\t\t),\n\t);\n\nprogram.section('Geometry', '🫖');\n\n// DRACO\nprogram\n\t.command('draco', 'Compress geometry with Draco')\n\t.help(\n\t\t`\nCompress mesh geometry with the Draco library. This type of compression affects\nonly geometry data — animation and textures are not compressed.\n\nCompresses\n- geometry (only triangle meshes)\n\n${underline('Documentation')}\n- https://gltf-transform.dev/classes/extensions.dracomeshcompression.html\n\n${underline('References')}\n- draco: https://github.com/google/draco\n- KHR_draco_mesh_compression: https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--method <method>', 'Compression method.', {\n\t\tvalidator: ['edgebreaker', 'sequential'],\n\t\tdefault: 'edgebreaker',\n\t})\n\t.option('--encode-speed <encodeSpeed>', 'Encoding speed vs. compression level, 1–10.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.encodeSpeed,\n\t})\n\t.option('--decode-speed <decodeSpeed>', 'Decoding speed vs. compression level, 1–10.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.decodeSpeed,\n\t})\n\t.option('--quantize-position <bits>', 'Quantization bits for POSITION, 1-16.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.quantizePosition,\n\t})\n\t.option('--quantize-normal <bits>', 'Quantization bits for NORMAL, 1-16.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.quantizeNormal,\n\t})\n\t.option('--quantize-color <bits>', 'Quantization bits for COLOR_*, 1-16.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.quantizeColor,\n\t})\n\t.option('--quantize-texcoord <bits>', 'Quantization bits for TEXCOORD_*, 1-16.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.quantizeTexcoord,\n\t})\n\t.option('--quantize-generic <bits>', 'Quantization bits for other attributes, 1-16.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: DRACO_DEFAULTS.quantizeGeneric,\n\t})\n\t.option('--quantization-volume <volume>', 'Bounds for quantization grid.', {\n\t\tvalidator: ['mesh', 'scene'],\n\t\tdefault: DRACO_DEFAULTS.quantizationVolume,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(draco(options as unknown as DracoOptions)),\n\t);\n\n// MESHOPT\nprogram\n\t.command('meshopt', 'Compress geometry and animation with Meshopt')\n\t.help(\n\t\t`\nCompress geometry, morph targets, and animation with Meshopt. Meshopt\ncompression decodes very quickly, and is best used in combination with a\nlossless compression method like brotli or gzip.\n\nCompresses\n- geometry (points, lines, triangle meshes)\n- morph targets\n- animation tracks\n\n${underline('Documentation')}\n- https://gltf-transform.dev/classes/extensions.meshoptcompression.html\n\n${underline('References')}\n- meshoptimizer: https://github.com/zeux/meshoptimizer\n- EXT_meshopt_compression: https://github.com/KhronosGroup/gltf/blob/main/extensions/2.0/Vendor/EXT_meshopt_compression/\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--level <level>', 'Compression level.', {\n\t\tvalidator: ['medium', 'high'],\n\t\tdefault: 'high',\n\t})\n\t.option('--quantize-position <bits>', 'Precision for POSITION attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizePosition,\n\t})\n\t.option('--quantize-normal <bits>', 'Precision for NORMAL and TANGENT attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizeNormal,\n\t})\n\t.option('--quantize-texcoord <bits>', 'Precision for TEXCOORD_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizeTexcoord,\n\t})\n\t.option('--quantize-color <bits>', 'Precision for COLOR_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizeColor,\n\t})\n\t.option('--quantize-weight <bits>', 'Precision for WEIGHTS_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizeWeight,\n\t})\n\t.option('--quantize-generic <bits>', 'Precision for custom (_*) attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: MESHOPT_DEFAULTS.quantizeGeneric,\n\t})\n\t.option('--quantization-volume <volume>', 'Bounds for quantization grid.', {\n\t\tvalidator: ['mesh', 'scene'],\n\t\tdefault: QUANTIZE_DEFAULTS.quantizationVolume,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(meshopt({ encoder: MeshoptEncoder, ...options })),\n\t);\n\n// QUANTIZE\nprogram\n\t.command('quantize', 'Quantize geometry, reducing precision and memory')\n\t.help(\n\t\t`\nQuantization is a simple type of compression taking 32-bit float vertex\nattributes and storing them as 16-bit or 8-bit integers. A quantization factor\nrestoring the original value (with some error) is applied on the GPU, although\nnode scales and positions may also be changed to account for the quantization.\n\nQuantized vertex attributes require less space, both on disk and on the GPU.\nMost vertex attribute types can be quantized from 8–16 bits, but are always\nstored in 8- or 16-bit accessors. While a value quantized to 12 bits still\noccupies 16 bits on disk, gzip (or other lossless compression) will be more\neffective on values quantized to lower bit depths. As a result, the default\nbit depths used by this command are generally between 8 and 16 bits.\n\nBit depths for indices and JOINTS_* are determined automatically.\n\nRequires KHR_mesh_quantization support.`.trim(),\n\t)\n\t.argument('<input>', 'Path to read glTF 2.0 (.glb, .gltf) input')\n\t.argument('<output>', 'Path to write output')\n\t.option('--pattern <pattern>', 'Pattern for vertex attributes (case-insensitive glob)', {\n\t\tvalidator: Validator.STRING,\n\t\tdefault: '*',\n\t})\n\t.option('--quantize-position <bits>', 'Precision for POSITION attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizePosition,\n\t})\n\t.option('--quantize-normal <bits>', 'Precision for NORMAL and TANGENT attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizeNormal,\n\t})\n\t.option('--quantize-texcoord <bits>', 'Precision for TEXCOORD_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizeTexcoord,\n\t})\n\t.option('--quantize-color <bits>', 'Precision for COLOR_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizeColor,\n\t})\n\t.option('--quantize-weight <bits>', 'Precision for WEIGHTS_* attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizeWeight,\n\t})\n\t.option('--quantize-generic <bits>', 'Precision for custom (_*) attributes.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: QUANTIZE_DEFAULTS.quantizeGeneric,\n\t})\n\t.option('--quantization-volume <volume>', 'Bounds for quantization grid.', {\n\t\tvalidator: ['mesh', 'scene'],\n\t\tdefault: QUANTIZE_DEFAULTS.quantizationVolume,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst pattern = micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS);\n\t\treturn Session.create(io, logger, args.input, args.output).transform(quantize({ ...options, pattern }));\n\t});\n\n// DEQUANTIZE\nprogram\n\t.command('dequantize', 'Dequantize geometry')\n\t.help(\n\t\t`\nRemoves quantization from an asset. This will increase the size of the asset on\ndisk and in memory, but may be necessary for applications that don't support\nquantization.\n\nRemoves KHR_mesh_quantization, if present.`.trim(),\n\t)\n\t.argument('<input>', 'Path to read glTF 2.0 (.glb, .gltf) input')\n\t.argument('<output>', 'Path to write output')\n\t.option('--pattern <pattern>', 'Pattern for vertex attributes (case-insensitive glob)', {\n\t\tvalidator: Validator.STRING,\n\t\tdefault: '!JOINTS_*',\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst pattern = micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS);\n\t\treturn Session.create(io, logger, args.input, args.output).transform(dequantize({ ...options, pattern }));\n\t});\n\n// WELD\nprogram\n\t.command('weld', 'Index geometry and optionally merge similar vertices')\n\t.help(\n\t\t`\nIndex geometry and optionally merge similar vertices. When merged and indexed,\ndata is shared more efficiently between vertices. File size can be reduced, and\nthe GPU can sometimes use the vertex cache more efficiently.\n\nWhen welding, the --tolerance threshold determines which vertices qualify for\nwelding based on distance between the vertices as a fraction of the primitive's\nbounding box (AABB). For example, --tolerance=0.01 welds vertices within +/-1%\nof the AABB's longest dimension. Other vertex attributes are also compared\nduring welding, with attribute-specific thresholds. For --tolerance=0, geometry\nis indexed in place, without merging.\n\nTo preserve visual appearance consistently, use low --tolerance-normal thresholds\naround 0.1 (±3º). To pre-processing a scene before simplification or LOD creation,\nuse higher thresholds around 0.5 (±30º).\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--tolerance', 'Tolerance for vertex positions, as a fraction of primitive AABB', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: WELD_DEFAULTS.tolerance,\n\t})\n\t.option('--tolerance-normal', 'Tolerance for vertex normals, in radians', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: WELD_DEFAULTS.toleranceNormal,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(weld(options as unknown as WeldOptions)),\n\t);\n\n// UNWELD\nprogram\n\t.command('unweld', 'De-index geometry, disconnecting any shared vertices')\n\t.help(\n\t\t`\nDe-index geometry, disconnecting any shared vertices. This tends to increase\nthe file size of the geometry and decrease efficiency, and so is not\nrecommended unless disconnected vertices (\"vertex soup\") are required for some\nparicular software application.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(unweld(options as unknown as UnweldOptions)),\n\t);\n\n// TANGENTS\nprogram\n\t.command('tangents', 'Generate MikkTSpace vertex tangents')\n\t.help(\n\t\t`\nGenerates MikkTSpace vertex tangents.\n\nIn some situations normal maps may appear incorrectly, displaying hard edges\nat seams, or unexpectedly inverted insets and extrusions. The issue is most\ncommonly caused by a mismatch between the software used to bake the normal map\nand the pixel shader or other code used to render it. While this may be a\nfrustration to an artist/designer, it is not always possible for the rendering\nengine to reconstruct the tangent space used by the authoring software.\n\nMost normal map bakers use the MikkTSpace standard (http://www.mikktspace.com/)\nto generate vertex tangents while creating a normal map, and the technique is\nrecommended by the glTF 2.0 specification. Generating vertex tangents with this\ntool may resolve rendering issues related to normal maps in engines that cannot\ncompute MikkTSpace tangents at runtime.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--overwrite', 'Overwrite existing vertex tangents', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(\n\t\t\ttangents({ generateTangents: mikktspace.generateTangents, ...options }),\n\t\t),\n\t);\n\n// REORDER\nprogram\n\t.command('reorder', 'Optimize vertex data for locality of reference')\n\t.help(\n\t\t`\nOptimize vertex data for locality of reference.\n\nChoose whether the order should be optimal for transmission size (recommended for Web) or for GPU\nrendering performance. When optimizing for transmission size, reordering is expected to be a pre-\nprocessing step before applying Meshopt compression and lossless supercompression (such as gzip or\nbrotli). Reordering will only reduce size when used in combination with other compression methods.\n\nBased on the meshoptimizer library (https://github.com/zeux/meshoptimizer).\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--target', 'Whether to optimize for transmission size or GPU performance', {\n\t\tvalidator: ['size', 'performance'],\n\t\tdefault: 'size',\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(reorder({ encoder: MeshoptEncoder, ...options })),\n\t);\n\n// SIMPLIFY\nprogram\n\t.command('simplify', 'Simplify mesh, reducing number of vertices')\n\t.help(\n\t\t`\nSimplify mesh, reducing number of vertices.\n\nSimplification algorithm producing meshes with fewer triangles and\nvertices. Simplification is lossy, but the algorithm aims to\npreserve visual quality as much as possible, for given parameters.\n\nThe algorithm aims to reach the target --ratio, while minimizing error. If\nerror exceeds the specified --error threshold, the algorithm will quit\nbefore reaching the target ratio. Examples:\n\n- ratio=0.5, error=0.001: Aims for 50% simplification, constrained to 0.1% error.\n- ratio=0.5, error=1: Aims for 50% simplification, unconstrained by error.\n- ratio=0.0, error=0.01: Aims for maximum simplification, constrained to 1% error.\n\nTopology, particularly split vertices, will also limit the simplifier. For\nbest results, apply a 'weld' operation before simplification.\n\nBased on the meshoptimizer library (https://github.com/zeux/meshoptimizer).\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--ratio <ratio>', 'Target ratio (0–1) of vertices to keep', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: SIMPLIFY_DEFAULTS.ratio,\n\t})\n\t.option('--error <error>', 'Limit on error, as a fraction of mesh radius', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: SIMPLIFY_DEFAULTS.error,\n\t})\n\t.option('--lock-border <lockBorder>', 'Whether to lock topological borders of the mesh', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: SIMPLIFY_DEFAULTS.lockBorder,\n\t})\n\t.action(async ({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(\n\t\t\tsimplify({ simplifier: MeshoptSimplifier, ...options }),\n\t\t),\n\t);\n\nprogram.section('Material', '🎨');\n\n// METALROUGH\nprogram\n\t.command('metalrough', 'Convert materials from spec/gloss to metal/rough')\n\t.help(\n\t\t`\nConvert materials from spec/gloss to metal/rough. In general, the metal/rough\nworkflow is better supported, more compact, and more future-proof. All features\nof the spec/gloss workflow can be converted to metal/rough, as long as the\nKHR_materials_specular and KHR_materials_ior extensions are supported. When one\nor both of those extensions are not supported, metallic materials may require\nfurther adjustments after the conversion.\n\nThis conversion rewrites spec/gloss textures, and the resulting textures may\nhave less optimal compression than the original. Ideally, lossless PNG textures\nshould be used as input, and then compressed after this conversion.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, logger }) => Session.create(io, logger, args.input, args.output).transform(metalRough()));\n\n// PALETTE\nprogram\n\t.command('palette', 'Creates palette textures and merges materials')\n\t.help(\n\t\t`\nCreates palette textures containing all unique values of scalar Material\nproperties within the scene, then merges materials. For scenes with many\nsolid-colored materials (often found in CAD, architectural, or low-poly\nstyles), texture palettes can reduce the number of materials used, and\nsignificantly increase the number of Mesh objects eligible for \"join\"\noperations.\n\nMaterials already containing texture coordinates (UVs) are not eligible for\ntexture palette optimizations. Currently only a material's base color,\nalpha, emissive factor, metallic factor, and roughness factor are converted\nto palette textures.\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--block-size <px>', 'Size (in pixels) of a single block within each palette texture.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: PALETTE_DEFAULTS.blockSize,\n\t})\n\t.option(\n\t\t'--min <count>',\n\t\t'Minimum number of blocks in the palette texture. If fewer unique ' +\n\t\t\t'material values are found, no palettes will be generated.',\n\t\t{\n\t\t\tvalidator: Validator.NUMBER,\n\t\t\tdefault: PALETTE_DEFAULTS.min,\n\t\t},\n\t)\n\t.action(async ({ args, options, logger }) => {\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\tpalette(options as unknown as PaletteOptions),\n\t\t);\n\t});\n\n// UNLIT\nprogram\n\t.command('unlit', 'Convert materials from metal/rough to unlit')\n\t.help(\n\t\t`\nConvert materials to an unlit, shadeless model. Unlit materials are not\naffected by scene lighting, and can be rendered very efficiently on less\ncapable mobile devices. If device framerate is high when an object occupies a\nsmall part of the viewport, and low when that object fills the viewport, it's\nlikely that the GPU is fragment shader bound, and a simpler material (such as\nan unlit material) may improve performance.\n\nUnlit materials are also helpful for non-physically-based visual styles.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, logger }) => Session.create(io, logger, args.input, args.output).transform(unlit()));\n\nprogram.section('Texture', '🖼');\n\n// RESIZE\nprogram\n\t.command('resize', 'Resize PNG or JPEG textures')\n\t.help(\n\t\t`\nResize PNG or JPEG textures with Lanczos3 (sharp) or Lanczos2 (smooth)\nfiltering. Typically Lanczos3 is the best method, but Lanczos2 may be helpful\nto reduce ringing artifacts in some cases.\n\nLimits --width and --height are applied as maximum dimensions for each texture,\npreserving original aspect ratio. Texture dimensions are never increased.\n`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--filter', 'Resampling filter', {\n\t\tvalidator: [TextureResizeFilter.LANCZOS3, TextureResizeFilter.LANCZOS2],\n\t\tdefault: TEXTURE_RESIZE_DEFAULTS.filter,\n\t})\n\t.option('--width <pixels>', 'Maximum width (px) of output textures.', {\n\t\tvalidator: Validator.NUMBER,\n\t\trequired: true,\n\t})\n\t.option('--height <pixels>', 'Maximum height (px) of output textures.', {\n\t\tvalidator: Validator.NUMBER,\n\t\trequired: true,\n\t})\n\t.action(async ({ args, options, logger }) => {\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tconst { default: encoder } = await import('sharp');\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\ttextureCompress({\n\t\t\t\tencoder,\n\t\t\t\tresize: [options.width, options.height] as vec2,\n\t\t\t\tresizeFilter: options.filter as TextureResizeFilter,\n\t\t\t\tpattern,\n\t\t\t}),\n\t\t);\n\t});\n\nconst BASIS_SUMMARY = `\nCompresses textures in the given file to .ktx2 GPU textures using the\n{VARIANT} Basis Universal bitstream. GPU textures offer faster GPU upload\nand less GPU memory consumption than traditional PNG or JPEG textures,\nwhich are fully uncompressed in GPU memory. GPU texture formats require\nmore attention to compression settings to get similar visual results.\n\n{DETAILS}\n\n${underline('Documentation')}\nhttps://gltf-transform.dev/extensions.html#khr_texture_basisu\n\n${underline('Dependencies')}\nKTX-Software (https://github.com/KhronosGroup/KTX-Software/)\n`;\n\n// ETC1S\nprogram\n\t.command('etc1s', 'KTX + Basis ETC1S texture compression')\n\t.help(\n\t\tBASIS_SUMMARY.replace('{VARIANT}', 'ETC1S').replace(\n\t\t\t'{DETAILS}',\n\t\t\t`\nETC1S, one of the two Basis Universal bitstreams, offers lower size and lower\nquality than UASTC. In some cases it may be useful to increase the resolution\nof the texture, to minimize compression artifacts while still retaining an\noverall smaller filesize. Consider using less aggressive compression settings\nfor normal maps than for other texture types: you may want to use UASTC for\nnormal maps and ETC1S for other textures, for example.`.trim(),\n\t\t),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING })\n\t.option('--filter <filter>', 'Specifies the filter to use when generating mipmaps.', {\n\t\tvalidator: Object.values(Filter),\n\t\tdefault: ETC1S_DEFAULTS.filter,\n\t})\n\t.option('--filter-scale <fscale>', 'Specifies the filter scale to use when generating mipmaps.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: ETC1S_DEFAULTS.filterScale,\n\t})\n\t.option(\n\t\t'--compression <clevel>',\n\t\t'Compression level, an encoding speed vs. quality tradeoff.' +\n\t\t\t' Higher values are slower, but give higher quality. Try' +\n\t\t\t' --quality before experimenting with this option.',\n\t\t{ validator: [0, 1, 2, 3, 4, 5], default: ETC1S_DEFAULTS.compression },\n\t)\n\t.option(\n\t\t'--quality <qlevel>',\n\t\t'Quality level. Range is 1 - 255. Lower gives better' +\n\t\t\t' compression, lower quality, and faster encoding. Higher gives less compression,' +\n\t\t\t' higher quality, and slower encoding. Quality level determines values of' +\n\t\t\t' --max_endpoints and --max-selectors, unless those values are explicitly set.',\n\t\t{ validator: Validator.NUMBER, default: ETC1S_DEFAULTS.quality },\n\t)\n\t.option(\n\t\t'--max-endpoints <max_endpoints>',\n\t\t'Manually set the maximum number of color endpoint clusters from' + ' 1-16128.',\n\t\t{ validator: Validator.NUMBER },\n\t)\n\t.option(\n\t\t'--max-selectors <max_selectors>',\n\t\t'Manually set the maximum number of color selector clusters from' + ' 1-16128.',\n\t\t{ validator: Validator.NUMBER },\n\t)\n\t.option(\n\t\t'--power-of-two',\n\t\t'Resizes any non-power-of-two textures to the closest power-of-two' +\n\t\t\t' dimensions, not exceeding 2048x2048px. Required for ' +\n\t\t\t' compatibility on some older devices and APIs, particularly ' +\n\t\t\t' WebGL 1.0.',\n\t\t{ validator: Validator.BOOLEAN },\n\t)\n\t.option(\n\t\t'--rdo-threshold <rdo_threshold>',\n\t\t'Set endpoint and selector RDO quality threshold. Lower' +\n\t\t\t' is higher quality but less quality per output bit (try 1.0-3.0).' +\n\t\t\t' Overrides --quality.',\n\t\t{ validator: Validator.NUMBER },\n\t)\n\t.option(\n\t\t'--rdo-off',\n\t\t'Disable endpoint and selector RDO (slightly' +\n\t\t\t' faster, less noisy output, but lower quality per output bit).',\n\t\t{ validator: Validator.BOOLEAN },\n\t)\n\t.option('--jobs <num_jobs>', 'Spawns up to num_jobs instances of toktx', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: ETC1S_DEFAULTS.jobs,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst mode = Mode.ETC1S;\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\treturn Session.create(io, logger, args.input, args.output).transform(toktx({ ...options, mode, pattern }));\n\t});\n\n// UASTC\nprogram\n\t.command('uastc', 'KTX + Basis UASTC texture compression')\n\t.help(\n\t\tBASIS_SUMMARY.replace('{VARIANT}', 'UASTC').replace(\n\t\t\t'{DETAILS}',\n\t\t\t`\nUASTC, one of the two Basis Universal bitstreams, offers higher size and higher\nquality than ETC1S. While it is suitable for all texture types, you may find it\nuseful to apply UASTC only where higher quality is necessary, and apply ETC1S\nfor textures where the quality is sufficient.`.trim(),\n\t\t),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING })\n\t.option('--filter <filter>', 'Specifies the filter to use when generating mipmaps.', {\n\t\tvalidator: Object.values(Filter),\n\t\tdefault: UASTC_DEFAULTS.filter,\n\t})\n\t.option('--filter-scale <fscale>', 'Specifies the filter scale to use when generating mipmaps.', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: UASTC_DEFAULTS.filterScale,\n\t})\n\t.option(\n\t\t'--level <level>',\n\t\t'Create a texture in high-quality transcodable UASTC format.' +\n\t\t\t' The optional parameter <level> selects a speed' +\n\t\t\t' vs quality tradeoff as shown in the following table:' +\n\t\t\t'\\n\\n' +\n\t\t\t'Level | Speed     | Quality' +\n\t\t\t'\\n——————|———————————|————————' +\n\t\t\t'\\n0     | Fastest   | 43.45dB' +\n\t\t\t'\\n1     | Faster    | 46.49dB' +\n\t\t\t'\\n2     | Default   | 47.47dB' +\n\t\t\t'\\n3     | Slower    | 48.01dB' +\n\t\t\t'\\n4     | Very slow | 48.24dB',\n\t\t{ validator: [0, 1, 2, 3, 4], default: UASTC_DEFAULTS.level },\n\t)\n\t.option(\n\t\t'--power-of-two',\n\t\t'Resizes any non-power-of-two textures to the closest power-of-two' +\n\t\t\t' dimensions, not exceeding 2048x2048px. Required for ' +\n\t\t\t' compatibility on some older devices and APIs, particularly ' +\n\t\t\t' WebGL 1.0.',\n\t\t{ validator: Validator.BOOLEAN },\n\t)\n\t.option(\n\t\t'--rdo <uastc_rdo_l>',\n\t\t'Enable UASTC RDO post-processing and optionally set UASTC RDO' +\n\t\t\t' quality scalar (lambda).  Lower values yield higher' +\n\t\t\t' quality/larger LZ compressed files, higher values yield lower' +\n\t\t\t' quality/smaller LZ compressed files. A good range to try is [.25, 10].' +\n\t\t\t' For normal maps, try [.25, .75]. Full range is [.001, 10.0].',\n\t\t{ validator: Validator.NUMBER, default: UASTC_DEFAULTS.rdo },\n\t)\n\t.option(\n\t\t'--rdo-dictionary-size <uastc_rdo_d>',\n\t\t'Set UASTC RDO dictionary size in bytes. Default is 32768. Lower' +\n\t\t\t' values=faster, but give less compression. Possible range is [256, 65536].',\n\t\t{ validator: Validator.NUMBER, default: UASTC_DEFAULTS.rdoDictionarySize },\n\t)\n\t.option(\n\t\t'--rdo-block-scale <uastc_rdo_b>',\n\t\t'Set UASTC RDO max smooth block error scale. Range is [1.0, 300.0].' +\n\t\t\t' Default is 10.0, 1.0 is disabled. Larger values suppress more' +\n\t\t\t' artifacts (and allocate more bits) on smooth blocks.',\n\t\t{ validator: Validator.NUMBER, default: UASTC_DEFAULTS.rdoBlockScale },\n\t)\n\t.option(\n\t\t'--rdo-std-dev <uastc_rdo_s>',\n\t\t'Set UASTC RDO max smooth block standard deviation. Range is' +\n\t\t\t' [.01, 65536.0]. Default is 18.0. Larger values expand the range' +\n\t\t\t' of blocks considered smooth.',\n\t\t{ validator: Validator.NUMBER, default: UASTC_DEFAULTS.rdoStdDev },\n\t)\n\t.option(\n\t\t'--rdo-multithreading <uastc_rdo_m>',\n\t\t'Enable RDO multithreading (slightly lower compression, non-deterministic).',\n\t\t{ validator: Validator.BOOLEAN, default: UASTC_DEFAULTS.rdoMultithreading },\n\t)\n\t.option(\n\t\t'--zstd <compressionLevel>',\n\t\t'Supercompress the data with Zstandard.' +\n\t\t\t' Compression level range is [1, 22], or 0 is uncompressed.' +\n\t\t\t' Lower values decode faster but offer less compression. Values above' +\n\t\t\t' 20 should be used with caution, requiring more memory to decompress:' +\n\t\t\t'\\n\\n' +\n\t\t\t// Sources:\n\t\t\t// - https://news.ycombinator.com/item?id=13814475\n\t\t\t// - https://github.com/facebook/zstd/blob/15a7a99653c78a57d1ccbf5c5b4571e62183bf4f/lib/compress/zstd_compress.c#L3250\n\t\t\t'Level | Window Size ' +\n\t\t\t'\\n——————|—————————————' +\n\t\t\t'\\n1     |      256 KB ' +\n\t\t\t'\\n…     |           … ' +\n\t\t\t'\\n10    |        2 MB ' +\n\t\t\t'\\n…     |           … ' +\n\t\t\t'\\n18    |        8 MB ' +\n\t\t\t'\\n19    |        8 MB ' +\n\t\t\t'\\n20    |       34 MB ' +\n\t\t\t'\\n21    |       67 MB ' +\n\t\t\t'\\n22    |      134 MB ',\n\t\t{ validator: Validator.NUMBER, default: UASTC_DEFAULTS.zstd },\n\t)\n\t.option('--jobs <num_jobs>', 'Spawns up to num_jobs instances of toktx', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: UASTC_DEFAULTS.jobs,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst mode = Mode.UASTC;\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tSession.create(io, logger, args.input, args.output).transform(toktx({ ...options, mode, pattern }));\n\t});\n\n// KTXFIX\nprogram\n\t.command('ktxfix', 'Fixes common issues in KTX texture metadata')\n\t.help(\n\t\t`\nCertain KTX texture metadata was written incorrectly in early (pre-release)\nsoftware. In particular, viewers may misinterpret color primaries as sRGB\nincorrectly when a texture exhibits this issue.\n\nThis command determines correct color primaries based on usage in the glTF\nfile, and updates the KTX texture accordingly. The change is lossless, and\naffects only the container metadata.`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, logger }) => Session.create(io, logger, args.input, args.output).transform(ktxfix()));\n\nconst TEXTURE_COMPRESS_SUMMARY = `\nCompresses textures with {VARIANT}, using sharp. Reduces transmitted file\nsize. Compared to GPU texture compression like KTX/Basis, PNG/JPEG/WebP must\nbe fully decompressed in GPU memory — this makes texture GPU upload much\nslower, and may consume 4-8x more GPU memory. However, the PNG/JPEG/WebP\ncompression methods are typically more forgiving than GPU texture compression,\nand require less tuning to achieve good visual and filesize results.\n`.trim();\n\n// AVIF\n// IMPORTANT: No defaults for quality flags, see https://github.com/donmccurdy/glTF-Transform/issues/969.\nprogram\n\t.command('avif', 'AVIF texture compression')\n\t.help(TEXTURE_COMPRESS_SUMMARY.replace(/{VARIANT}/g, 'AVIF'))\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--formats <formats>', 'Texture formats to include', {\n\t\tvalidator: [...TEXTURE_COMPRESS_SUPPORTED_FORMATS, '*'],\n\t\tdefault: '*',\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING, default: '*' })\n\t.option('--quality <quality>', 'Quality, 1-100', { validator: Validator.NUMBER })\n\t.option('--effort <effort>', 'Level of CPU effort to reduce file size, 0-100', { validator: Validator.NUMBER })\n\t.option('--lossless <lossless>', 'Use lossless compression mode', { validator: Validator.BOOLEAN, default: false })\n\t.action(async ({ args, options, logger }) => {\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tconst formats = regexFromArray([options.formats] as string[]);\n\t\tconst slots = micromatch.makeRe(String(options.slots), MICROMATCH_OPTIONS);\n\t\tconst { default: encoder } = await import('sharp');\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\ttextureCompress({\n\t\t\t\ttargetFormat: 'avif',\n\t\t\t\tencoder,\n\t\t\t\tpattern,\n\t\t\t\tformats,\n\t\t\t\tslots,\n\t\t\t\tquality: options.quality as number,\n\t\t\t\teffort: options.effort as number,\n\t\t\t\tlossless: options.lossless as boolean,\n\t\t\t}),\n\t\t);\n\t});\n\n// WEBP\n// IMPORTANT: No defaults for quality flags, see https://github.com/donmccurdy/glTF-Transform/issues/969.\nprogram\n\t.command('webp', 'WebP texture compression')\n\t.help(TEXTURE_COMPRESS_SUMMARY.replace(/{VARIANT}/g, 'WebP'))\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--formats <formats>', 'Texture formats to include', {\n\t\tvalidator: [...TEXTURE_COMPRESS_SUPPORTED_FORMATS, '*'],\n\t\tdefault: '*',\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING, default: '*' })\n\t.option('--quality <quality>', 'Quality, 1-100', { validator: Validator.NUMBER })\n\t.option('--effort <effort>', 'Level of CPU effort to reduce file size, 0-100', { validator: Validator.NUMBER })\n\t.option('--lossless <lossless>', 'Use lossless compression mode', { validator: Validator.BOOLEAN, default: false })\n\t.option('--near-lossless <nearLossless>', 'Use near lossless compression mode.', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: false,\n\t})\n\t.action(async ({ args, options, logger }) => {\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tconst formats = regexFromArray([options.formats] as string[]);\n\t\tconst slots = micromatch.makeRe(String(options.slots), MICROMATCH_OPTIONS);\n\t\tconst { default: encoder } = await import('sharp');\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\ttextureCompress({\n\t\t\t\ttargetFormat: 'webp',\n\t\t\t\tencoder,\n\t\t\t\tpattern,\n\t\t\t\tformats,\n\t\t\t\tslots,\n\t\t\t\tquality: options.quality as number,\n\t\t\t\teffort: options.effort as number,\n\t\t\t\tlossless: options.lossless as boolean,\n\t\t\t\tnearLossless: options.nearLossless as boolean,\n\t\t\t}),\n\t\t);\n\t});\n\n// PNG\n// IMPORTANT: No defaults for quality flags, see https://github.com/donmccurdy/glTF-Transform/issues/969.\nprogram\n\t.command('png', 'PNG texture compression')\n\t.help(TEXTURE_COMPRESS_SUMMARY.replace(/{VARIANT}/g, 'PNG'))\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--formats <formats>', 'Texture formats to include', {\n\t\tvalidator: [...TEXTURE_COMPRESS_SUPPORTED_FORMATS, '*'],\n\t\tdefault: 'png',\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING, default: '*' })\n\t.option('--quality <quality>', 'Quality, 1-100', { validator: Validator.NUMBER })\n\t.option('--effort <effort>', 'Level of CPU effort to reduce file size, 0-100', { validator: Validator.NUMBER })\n\t.action(async ({ args, options, logger }) => {\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tconst formats = regexFromArray([options.formats] as string[]);\n\t\tconst slots = micromatch.makeRe(String(options.slots), MICROMATCH_OPTIONS);\n\t\tconst { default: encoder } = await import('sharp');\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\ttextureCompress({\n\t\t\t\ttargetFormat: 'png',\n\t\t\t\tencoder,\n\t\t\t\tpattern,\n\t\t\t\tformats,\n\t\t\t\tslots,\n\t\t\t\tquality: options.quality as number,\n\t\t\t\teffort: options.effort as number,\n\t\t\t}),\n\t\t);\n\t});\n\n// JPEG\n// IMPORTANT: No defaults for quality flags, see https://github.com/donmccurdy/glTF-Transform/issues/969.\nprogram\n\t.command('jpeg', 'JPEG texture compression')\n\t.help(TEXTURE_COMPRESS_SUMMARY.replace(/{VARIANT}/g, 'JPEG'))\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--pattern <pattern>', 'Pattern (glob) to match textures, by name or URI.', {\n\t\tvalidator: Validator.STRING,\n\t})\n\t.option('--formats <formats>', 'Texture formats to include', {\n\t\tvalidator: [...TEXTURE_COMPRESS_SUPPORTED_FORMATS, '*'],\n\t\tdefault: 'jpeg',\n\t})\n\t.option('--slots <slots>', 'Texture slots to include (glob)', { validator: Validator.STRING, default: '*' })\n\t.option('--quality <quality>', 'Quality, 1-100', { validator: Validator.NUMBER })\n\t.action(async ({ args, options, logger }) => {\n\t\tconst pattern = options.pattern ? micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS) : null;\n\t\tconst formats = regexFromArray([options.formats] as string[]);\n\t\tconst slots = micromatch.makeRe(String(options.slots), MICROMATCH_OPTIONS);\n\t\tconst { default: encoder } = await import('sharp');\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\ttextureCompress({\n\t\t\t\ttargetFormat: 'jpeg',\n\t\t\t\tencoder,\n\t\t\t\tpattern,\n\t\t\t\tformats,\n\t\t\t\tslots,\n\t\t\t\tquality: options.quality as number,\n\t\t\t}),\n\t\t);\n\t});\n\nprogram.section('Animation', '⏯️');\n\n// RESAMPLE\nprogram\n\t.command('resample', 'Resample animations, losslessly deduplicating keyframes')\n\t.help(\n\t\t`\nResample animations, losslessly deduplicating keyframes. Exporters sometimes\nneed to \"bake\" animations, writing data for 20-30 frames per second, in order\nto correctly represent IK constraints and other animation techniques. These\nadditional keyframes are often redundant — particularly with morph targets —\nas engines can interpolate animation at 60–120 FPS even with sparse keyframes.\n\nThe resampling process removes redundant keyframes from animations using STEP\nand LINEAR interpolation. Resampling is nearly lossless, with configurable\n--tolerance, and should have no visible effect on animation playback.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--tolerance', 'Per-value tolerance to merge similar keyframes', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: 1e-4,\n\t})\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(\n\t\t\tresample({\n\t\t\t\tready: resampleReady,\n\t\t\t\tresample: resampleWASM,\n\t\t\t\t...(options as unknown as ResampleOptions),\n\t\t\t}),\n\t\t),\n\t);\n\n// SEQUENCE\nprogram\n\t.command('sequence', 'Animate node visibilities as a flipboard sequence')\n\t.help(\n\t\t`\nAnimate node visibilities as a flipboard sequence. An example workflow would\nbe to create a .glb containing one geometry for each frame of a complex\nanimation that can't be represented as TRS, skinning, or morph targets. The\nsequence function generates a new animation, playing back each mesh matching\nthe given pattern, at a specific framerate. Displaying a sequence of textures\nis also supported, but note that texture memory usage may be quite high and\nso this workflow is not a replacement for video playback.\n\t`.trim(),\n\t)\n\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.option('--name <name>', 'Name of new animation', {\n\t\tvalidator: Validator.STRING,\n\t\tdefault: '',\n\t})\n\t.option('--pattern <pattern>', 'Pattern for node names (case-insensitive glob)', {\n\t\tvalidator: Validator.STRING,\n\t\trequired: true,\n\t})\n\t.option('--fps <fps>', 'FPS (frames / second)', {\n\t\tvalidator: Validator.NUMBER,\n\t\tdefault: 10,\n\t})\n\t.option('--sort <sort>', 'Order sequence by node name', {\n\t\tvalidator: Validator.BOOLEAN,\n\t\tdefault: true,\n\t})\n\t.action(({ args, options, logger }) => {\n\t\tconst pattern = micromatch.makeRe(String(options.pattern), MICROMATCH_OPTIONS);\n\t\treturn Session.create(io, logger, args.input, args.output).transform(\n\t\t\tsequence({ ...options, pattern } as SequenceOptions),\n\t\t);\n\t});\n\n// SPARSE\nprogram\n\t.command('sparse', 'Reduces storage for zero-filled arrays')\n\t.help(\n\t\t`\nScans all Accessors in the Document, detecting whether each Accessor would\nbenefit from sparse data storage. Currently, sparse data storage is used only\nwhen many values (>= 1/3) are zeroes. Particularly for assets using morph\ntarget (\"shape key\") animation, sparse data storage may significantly reduce\nfile sizes.\n\t`.trim(),\n\t)\n\t.argument('<input>', INPUT_DESC)\n\t.argument('<output>', OUTPUT_DESC)\n\t.action(({ args, options, logger }) =>\n\t\tSession.create(io, logger, args.input, args.output).transform(sparse(options as unknown as SparseOptions)),\n\t);\n\nprogram.option('--allow-http', 'Allows reads from HTTP requests.', {\n\tdefault: false,\n\tvalidator: Validator.BOOLEAN,\n\taction: ({ options }) => {\n\t\tif (options.allowHttp) io.setAllowHTTP(true);\n\t},\n});\nprogram.option('--vertex-layout <layout>', 'Vertex buffer layout preset.', {\n\tdefault: VertexLayout.INTERLEAVED,\n\tvalidator: [VertexLayout.INTERLEAVED, VertexLayout.SEPARATE],\n\taction: ({ options }) => {\n\t\tio.setVertexLayout(options.vertexLayout as VertexLayout);\n\t},\n});\nprogram.option('--config <path>', 'Installs custom commands or extensions. (EXPERIMENTAL)', {\n\tvalidator: Validator.STRING,\n});\nprogram.disableGlobalOption('--quiet');\nprogram.disableGlobalOption('--no-color');\n\nexport { program, programReady };\nexport * from './util.js';\nexport * from './transforms/index.js';\n"],"names":["XMPContext","dc","model3d","rdf","xmp","xmpRights","MICROMATCH_OPTIONS","nocase","contains","regexFromArray","values","pattern","map","s","join","micromatch","makeRe","spawn","_spawn","commandExists","cmd","_commandExists","catch","waitExit","_waitExit","mockSpawn","mockCommandExists","mockWaitExit","process","stdout","chunk","stderr","status","Promise","resolve","_","on","formatLong","x","toString","replace","formatBytes","bytes","decimals","k","dm","sizes","i","Math","floor","log","parseFloat","pow","toFixed","formatParagraph","str","match","line","trim","formatHeader","title","toUpperCase","TableFormat","CLI_TABLE_MARKDOWN_CHARS","top","bottom","left","mid","right","middle","formatTable","format","head","rows","PRETTY","table","CLITable","push","CSV","reject","stringify","err","output","MD","chars","Array","length","fill","stripAnsi","formatXMP","value","list","hasCommas","some","indexOf","JSON","underline","dim","inspect","jsonDoc","io","logger","extensionsUsed","json","extensionsRequired","console","asset","version","generator","document","readJSON","e","warn","rootPacket","getRoot","getExtension","listProperties","name","getProperty","report","inspectDoc","reportSection","scenes","meshes","materials","textures","animations","type","section","properties","formattedRecords","property","index","formatPropertyReport","header","Object","keys","p","footnotes","getFootnotes","warnings","forEach","warning","row","key","isArray","NAME","ktxfix","doc","getLogger","numChanged","texture","listTextures","getMimeType","image","getImage","ktx","read","dfd","dataFormatDescriptor","slots","listTextureSlots","colorSpace","getTextureColorSpace","colorPrimaries","KHR_DF_PRIMARIES_BT709","KHR_DF_PRIMARIES_UNSPECIFIED","getURI","getName","changed","info","setImage","write","debug","merge","options","paths","root","path","basename","FileUtils","extension","toLowerCase","includes","createTexture","fs","readFileSync","setMimeType","ImageUtils","extensionToMimeType","setURI","renameScenes","Error","rootScene","listScenes","scene","setDefaultScene","mergeScenes","child","listChildren","removeChild","addChild","dispose","transform","dedup","propertyTypes","PropertyType","TEXTURE","createUniqueURIs","listBuffers","partition","unpartition","setName","resources","total","used","resource","uri","prefix","RegExp","tmp","setGracefulCleanup","NUM_CPUS","os","cpus","KTX_SOFTWARE_VERSION_MIN","KTX_SOFTWARE_VERSION_ACTIVE","R","G","TextureChannel","Mode","ETC1S","UASTC","Filter","BOX","TENT","BELL","BSPLINE","MITCHELL","LANCZOS3","LANCZOS4","LANCZOS6","LANCZOS12","BLACKMAN","KAISER","GAUSSIAN","CATMULLROM","QUADRATIC_INTERP","QUADRATIC_APPROX","QUADRATIC_MIX","GLOBAL_DEFAULTS","filter","filterScale","powerOfTwo","jobs","ETC1S_DEFAULTS","quality","compression","UASTC_DEFAULTS","level","rdo","rdoDictionarySize","rdoBlockScale","rdoStdDev","rdoMultithreading","zstd","toktx","mode","createTransform","checkKTXSoftware","batchPrefix","uuid","batchDir","tmpdir","existsSync","mkdirSync","basisuExtension","createExtension","KHRTextureBasisu","setRequired","numCompressed","limit","pLimit","numTextures","promises","textureIndex","channels","getTextureChannelMask","textureLabel","patternRe","slotsRe","find","slot","size","resize","getSize","mimeTypeToExtension","inPath","outPath","inBytes","byteLength","writeFile","Buffer","from","params","createParams","error","readFile","outBytes","all","usesKTX2","t","_options","maxEndpoints","maxSelectors","rdoOff","rdoThreshold","isMatch","semver","gte","width","height","preferredPowerOfTwo","isPowerOfTwo","isMultipleOfFour","ceilMultipleOfFour","threads","max","min","env","CI","valid","clean","lt","lo","floorPowerOfTwo","hi","ceilPowerOfTwo","LN2","ceil","DEFAULT_LANG","XMP_DEFAULTS","packet","reset","Prompt","generateQuestions","results","lang","message","loop","pageSize","choices","CREATOR","TITLE","DESCRIPTION","RELATED","inquirer","Separator","CREATE_DATE","LANGUAGE","RIGHTS","PREFERRED_SURFACE","prompts","Set","_prompts","has","suffix","validate","input","languageTags","check","default","createList","transformer","createLanguageAlternative","split","url","_rights","usage","_usage","test","_isLicenseSPDX","validateSPDX","Date","toISOString","substring","validateDate","short","xmpExtension","KHRXMP","packetPath","packetJSON","packetDef","validatePacket","parse","createPacket","fromJSONLD","setExtension","toJSONLD","question","assign","prompt","checkTTY","setContext","getContext","createContext","numProperties","startsWith","setProperty","context","isTtyError","language","date","_object","acc","prototype","call","object","Session","constructor","_io","_logger","_input","_output","_outputFormat","_display","setLogger","Format","GLB","GLTF","create","setDisplay","display","transforms","Document","extensionName","listExtensionsUsed","tasks","task","ctx","time","performance","now","round","padEnd","prevLevel","getVerbosity","Verbosity","INFO","setVerbosity","WARN","Listr","renderer","registerSignalListeners","run","updateMetadata","lastReadBytes","lastWriteBytes","ext","buffer","validator","validateBytes","Uint8Array","maxIssues","ignoredIssues","ignore","externalResourceFunction","dirname","decodeURIComponent","then","printIssueSection","severity","messages","issues","msg","m","customConfigPromise","createDefaultConfig","draco3d","createDecoderModule","createEncoderModule","MeshoptDecoder","ready","MeshoptEncoder","decoder","encoder","extensions","ALL_EXTENSIONS","dependencies","onProgramReady","undefined","loadConfig","cwd","validateConfig","config","EXTENSION_NAME","getConfig","customConfig","PAD_EMOJI","ProgramImpl","_program","description","desc","help","_name","_icon","icon","command","CommandImpl","option","global","disableGlobalOption","exec","args","program","_ctx","text","argument","action","fn","Logger","alias","Validator","NUMBER","ARRAY","BOOLEAN","STRING","_verbosity","ERROR","DEBUG","verbosity","programReady","argv","NodeIO","fetch","registerExtensions","registerDependencies","INPUT_DESC","OUTPUT_DESC","PACKAGE","URL","import","meta","sectionName","readAsJSON","SIMPLIFY_DEFAULTS","opts","instance","instanceMin","palette","paletteMin","flatten","weld","tolerance","simplify","simplifyError","WELD_DEFAULTS","toleranceNormal","simplifier","MeshoptSimplifier","resample","resampleReady","resampleWASM","prune","keepAttributes","keepIndices","keepLeaves","keepSolidTextures","sparse","textureCompress","slotsUASTC","targetFormat","textureSize","compress","draco","meshopt","quantize","pop","accessors","ACCESSOR","MATERIAL","MESH","skins","SKIN","inBuffer","outBuffer","gzip","fileName","inSize","outSize","center","JOIN_DEFAULTS","keepMeshes","keepNamed","DRACO_DEFAULTS","encodeSpeed","decodeSpeed","quantizePosition","quantizeNormal","quantizeColor","quantizeTexcoord","quantizeGeneric","quantizationVolume","MESHOPT_DEFAULTS","quantizeWeight","QUANTIZE_DEFAULTS","String","dequantize","unweld","tangents","generateTangents","mikktspace","reorder","ratio","lockBorder","metalRough","PALETTE_DEFAULTS","blockSize","unlit","TextureResizeFilter","LANCZOS2","TEXTURE_RESIZE_DEFAULTS","required","resizeFilter","BASIS_SUMMARY","TEXTURE_COMPRESS_SUMMARY","TEXTURE_COMPRESS_SUPPORTED_FORMATS","formats","effort","lossless","nearLossless","sequence","allowHttp","setAllowHTTP","VertexLayout","INTERLEAVED","SEPARATE","setVertexLayout","vertexLayout"],"mappings":"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"}